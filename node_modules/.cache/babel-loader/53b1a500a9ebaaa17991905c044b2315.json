{"ast":null,"code":"import { Vector3, Vector2, Triangle, DoubleSide, BackSide } from 'three'; // Ripped and modified From THREE.js Mesh raycast\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L115\n\nvar vA = new Vector3();\nvar vB = new Vector3();\nvar vC = new Vector3();\nvar uvA = new Vector2();\nvar uvB = new Vector2();\nvar uvC = new Vector2();\nvar intersectionPoint = new Vector3();\nvar intersectionPointWorld = new Vector3();\n\nfunction checkIntersection(object, material, raycaster, ray, pA, pB, pC, point) {\n  var intersect;\n\n  if (material.side === BackSide) {\n    intersect = ray.intersectTriangle(pC, pB, pA, true, point);\n  } else {\n    intersect = ray.intersectTriangle(pA, pB, pC, material.side !== DoubleSide, point);\n  }\n\n  if (intersect === null) return null;\n  intersectionPointWorld.copy(point);\n  intersectionPointWorld.applyMatrix4(object.matrixWorld);\n  var distance = raycaster.ray.origin.distanceTo(intersectionPointWorld);\n  if (distance < raycaster.near || distance > raycaster.far) return null;\n  return {\n    distance: distance,\n    point: intersectionPointWorld.clone(),\n    object: object\n  };\n}\n\nfunction checkBufferGeometryIntersection(object, raycaster, ray, position, uv, a, b, c) {\n  vA.fromBufferAttribute(position, a);\n  vB.fromBufferAttribute(position, b);\n  vC.fromBufferAttribute(position, c);\n  var intersection = checkIntersection(object, object.material, raycaster, ray, vA, vB, vC, intersectionPoint);\n\n  if (intersection) {\n    if (uv) {\n      uvA.fromBufferAttribute(uv, a);\n      uvB.fromBufferAttribute(uv, b);\n      uvC.fromBufferAttribute(uv, c);\n      intersection.uv = Triangle.getUV(intersectionPoint, vA, vB, vC, uvA, uvB, uvC, new Vector2());\n    }\n\n    const face = {\n      a: a,\n      b: b,\n      c: c,\n      normal: new Vector3(),\n      materialIndex: 0\n    };\n    Triangle.getNormal(vA, vB, vC, face.normal);\n    intersection.face = face;\n    intersection.faceIndex = a;\n  }\n\n  return intersection;\n} // https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L258\n\n\nfunction intersectTri(mesh, geo, raycaster, ray, tri, intersections) {\n  const triOffset = tri * 3;\n  const a = geo.index.getX(triOffset);\n  const b = geo.index.getX(triOffset + 1);\n  const c = geo.index.getX(triOffset + 2);\n  const intersection = checkBufferGeometryIntersection(mesh, raycaster, ray, geo.attributes.position, geo.attributes.uv, a, b, c);\n\n  if (intersection) {\n    intersection.faceIndex = tri;\n    if (intersections) intersections.push(intersection);\n    return intersection;\n  }\n\n  return null;\n}\n\nexport { intersectTri };","map":{"version":3,"sources":["/Users/a2017/Documents/GitHub/react-3d-drag/node_modules/three-mesh-bvh/src/Utils/ThreeIntersectionUtilities.js"],"names":["Vector3","Vector2","Triangle","DoubleSide","BackSide","vA","vB","vC","uvA","uvB","uvC","intersectionPoint","intersectionPointWorld","checkIntersection","object","material","raycaster","ray","pA","pB","pC","point","intersect","side","intersectTriangle","copy","applyMatrix4","matrixWorld","distance","origin","distanceTo","near","far","clone","checkBufferGeometryIntersection","position","uv","a","b","c","fromBufferAttribute","intersection","getUV","face","normal","materialIndex","getNormal","faceIndex","intersectTri","mesh","geo","tri","intersections","triOffset","index","getX","attributes","push"],"mappings":"AAAA,SAASA,OAAT,EAAkBC,OAAlB,EAA2BC,QAA3B,EAAqCC,UAArC,EAAiDC,QAAjD,QAAiE,OAAjE,C,CAEA;AACA;;AACA,IAAIC,EAAE,GAAG,IAAIL,OAAJ,EAAT;AACA,IAAIM,EAAE,GAAG,IAAIN,OAAJ,EAAT;AACA,IAAIO,EAAE,GAAG,IAAIP,OAAJ,EAAT;AAEA,IAAIQ,GAAG,GAAG,IAAIP,OAAJ,EAAV;AACA,IAAIQ,GAAG,GAAG,IAAIR,OAAJ,EAAV;AACA,IAAIS,GAAG,GAAG,IAAIT,OAAJ,EAAV;AAEA,IAAIU,iBAAiB,GAAG,IAAIX,OAAJ,EAAxB;AACA,IAAIY,sBAAsB,GAAG,IAAIZ,OAAJ,EAA7B;;AAEA,SAASa,iBAAT,CAA4BC,MAA5B,EAAoCC,QAApC,EAA8CC,SAA9C,EAAyDC,GAAzD,EAA8DC,EAA9D,EAAkEC,EAAlE,EAAsEC,EAAtE,EAA0EC,KAA1E,EAAkF;AAEjF,MAAIC,SAAJ;;AACA,MAAKP,QAAQ,CAACQ,IAAT,KAAkBnB,QAAvB,EAAkC;AAEjCkB,IAAAA,SAAS,GAAGL,GAAG,CAACO,iBAAJ,CAAuBJ,EAAvB,EAA2BD,EAA3B,EAA+BD,EAA/B,EAAmC,IAAnC,EAAyCG,KAAzC,CAAZ;AAEA,GAJD,MAIO;AAENC,IAAAA,SAAS,GAAGL,GAAG,CAACO,iBAAJ,CAAuBN,EAAvB,EAA2BC,EAA3B,EAA+BC,EAA/B,EAAmCL,QAAQ,CAACQ,IAAT,KAAkBpB,UAArD,EAAiEkB,KAAjE,CAAZ;AAEA;;AAED,MAAKC,SAAS,KAAK,IAAnB,EAA0B,OAAO,IAAP;AAE1BV,EAAAA,sBAAsB,CAACa,IAAvB,CAA6BJ,KAA7B;AACAT,EAAAA,sBAAsB,CAACc,YAAvB,CAAqCZ,MAAM,CAACa,WAA5C;AAEA,MAAIC,QAAQ,GAAGZ,SAAS,CAACC,GAAV,CAAcY,MAAd,CAAqBC,UAArB,CAAiClB,sBAAjC,CAAf;AAEA,MAAKgB,QAAQ,GAAGZ,SAAS,CAACe,IAArB,IAA6BH,QAAQ,GAAGZ,SAAS,CAACgB,GAAvD,EAA6D,OAAO,IAAP;AAE7D,SAAO;AACNJ,IAAAA,QAAQ,EAAEA,QADJ;AAENP,IAAAA,KAAK,EAAET,sBAAsB,CAACqB,KAAvB,EAFD;AAGNnB,IAAAA,MAAM,EAAEA;AAHF,GAAP;AAMA;;AAED,SAASoB,+BAAT,CAA0CpB,MAA1C,EAAkDE,SAAlD,EAA6DC,GAA7D,EAAkEkB,QAAlE,EAA4EC,EAA5E,EAAgFC,CAAhF,EAAmFC,CAAnF,EAAsFC,CAAtF,EAA0F;AAEzFlC,EAAAA,EAAE,CAACmC,mBAAH,CAAwBL,QAAxB,EAAkCE,CAAlC;AACA/B,EAAAA,EAAE,CAACkC,mBAAH,CAAwBL,QAAxB,EAAkCG,CAAlC;AACA/B,EAAAA,EAAE,CAACiC,mBAAH,CAAwBL,QAAxB,EAAkCI,CAAlC;AAEA,MAAIE,YAAY,GAAG5B,iBAAiB,CAAEC,MAAF,EAAUA,MAAM,CAACC,QAAjB,EAA2BC,SAA3B,EAAsCC,GAAtC,EAA2CZ,EAA3C,EAA+CC,EAA/C,EAAmDC,EAAnD,EAAuDI,iBAAvD,CAApC;;AAEA,MAAK8B,YAAL,EAAoB;AAEnB,QAAKL,EAAL,EAAU;AAET5B,MAAAA,GAAG,CAACgC,mBAAJ,CAAyBJ,EAAzB,EAA6BC,CAA7B;AACA5B,MAAAA,GAAG,CAAC+B,mBAAJ,CAAyBJ,EAAzB,EAA6BE,CAA7B;AACA5B,MAAAA,GAAG,CAAC8B,mBAAJ,CAAyBJ,EAAzB,EAA6BG,CAA7B;AAEAE,MAAAA,YAAY,CAACL,EAAb,GAAkBlC,QAAQ,CAACwC,KAAT,CAAgB/B,iBAAhB,EAAmCN,EAAnC,EAAuCC,EAAvC,EAA2CC,EAA3C,EAA+CC,GAA/C,EAAoDC,GAApD,EAAyDC,GAAzD,EAA8D,IAAIT,OAAJ,EAA9D,CAAlB;AAEA;;AAED,UAAM0C,IAAI,GAAG;AACZN,MAAAA,CAAC,EAAEA,CADS;AAEZC,MAAAA,CAAC,EAAEA,CAFS;AAGZC,MAAAA,CAAC,EAAEA,CAHS;AAIZK,MAAAA,MAAM,EAAE,IAAI5C,OAAJ,EAJI;AAKZ6C,MAAAA,aAAa,EAAE;AALH,KAAb;AAQA3C,IAAAA,QAAQ,CAAC4C,SAAT,CAAoBzC,EAApB,EAAwBC,EAAxB,EAA4BC,EAA5B,EAAgCoC,IAAI,CAACC,MAArC;AAEAH,IAAAA,YAAY,CAACE,IAAb,GAAoBA,IAApB;AACAF,IAAAA,YAAY,CAACM,SAAb,GAAyBV,CAAzB;AAEA;;AAED,SAAOI,YAAP;AAEA,C,CAED;;;AACA,SAASO,YAAT,CAAuBC,IAAvB,EAA6BC,GAA7B,EAAkClC,SAAlC,EAA6CC,GAA7C,EAAkDkC,GAAlD,EAAuDC,aAAvD,EAAuE;AAEtE,QAAMC,SAAS,GAAGF,GAAG,GAAG,CAAxB;AACA,QAAMd,CAAC,GAAGa,GAAG,CAACI,KAAJ,CAAUC,IAAV,CAAgBF,SAAhB,CAAV;AACA,QAAMf,CAAC,GAAGY,GAAG,CAACI,KAAJ,CAAUC,IAAV,CAAgBF,SAAS,GAAG,CAA5B,CAAV;AACA,QAAMd,CAAC,GAAGW,GAAG,CAACI,KAAJ,CAAUC,IAAV,CAAgBF,SAAS,GAAG,CAA5B,CAAV;AAEA,QAAMZ,YAAY,GAAGP,+BAA+B,CAAEe,IAAF,EAAQjC,SAAR,EAAmBC,GAAnB,EAAwBiC,GAAG,CAACM,UAAJ,CAAerB,QAAvC,EAAiDe,GAAG,CAACM,UAAJ,CAAepB,EAAhE,EAAoEC,CAApE,EAAuEC,CAAvE,EAA0EC,CAA1E,CAApD;;AAEA,MAAKE,YAAL,EAAoB;AAEnBA,IAAAA,YAAY,CAACM,SAAb,GAAyBI,GAAzB;AACA,QAAKC,aAAL,EAAqBA,aAAa,CAACK,IAAd,CAAoBhB,YAApB;AACrB,WAAOA,YAAP;AAEA;;AAED,SAAO,IAAP;AAEA;;AAED,SAASO,YAAT","sourcesContent":["import { Vector3, Vector2, Triangle, DoubleSide, BackSide } from 'three';\r\n\r\n// Ripped and modified From THREE.js Mesh raycast\r\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L115\r\nvar vA = new Vector3();\r\nvar vB = new Vector3();\r\nvar vC = new Vector3();\r\n\r\nvar uvA = new Vector2();\r\nvar uvB = new Vector2();\r\nvar uvC = new Vector2();\r\n\r\nvar intersectionPoint = new Vector3();\r\nvar intersectionPointWorld = new Vector3();\r\n\r\nfunction checkIntersection( object, material, raycaster, ray, pA, pB, pC, point ) {\r\n\r\n\tvar intersect;\r\n\tif ( material.side === BackSide ) {\r\n\r\n\t\tintersect = ray.intersectTriangle( pC, pB, pA, true, point );\r\n\r\n\t} else {\r\n\r\n\t\tintersect = ray.intersectTriangle( pA, pB, pC, material.side !== DoubleSide, point );\r\n\r\n\t}\r\n\r\n\tif ( intersect === null ) return null;\r\n\r\n\tintersectionPointWorld.copy( point );\r\n\tintersectionPointWorld.applyMatrix4( object.matrixWorld );\r\n\r\n\tvar distance = raycaster.ray.origin.distanceTo( intersectionPointWorld );\r\n\r\n\tif ( distance < raycaster.near || distance > raycaster.far ) return null;\r\n\r\n\treturn {\r\n\t\tdistance: distance,\r\n\t\tpoint: intersectionPointWorld.clone(),\r\n\t\tobject: object\r\n\t};\r\n\r\n}\r\n\r\nfunction checkBufferGeometryIntersection( object, raycaster, ray, position, uv, a, b, c ) {\r\n\r\n\tvA.fromBufferAttribute( position, a );\r\n\tvB.fromBufferAttribute( position, b );\r\n\tvC.fromBufferAttribute( position, c );\r\n\r\n\tvar intersection = checkIntersection( object, object.material, raycaster, ray, vA, vB, vC, intersectionPoint );\r\n\r\n\tif ( intersection ) {\r\n\r\n\t\tif ( uv ) {\r\n\r\n\t\t\tuvA.fromBufferAttribute( uv, a );\r\n\t\t\tuvB.fromBufferAttribute( uv, b );\r\n\t\t\tuvC.fromBufferAttribute( uv, c );\r\n\r\n\t\t\tintersection.uv = Triangle.getUV( intersectionPoint, vA, vB, vC, uvA, uvB, uvC, new Vector2( ) );\r\n\r\n\t\t}\r\n\r\n\t\tconst face = {\r\n\t\t\ta: a,\r\n\t\t\tb: b,\r\n\t\t\tc: c,\r\n\t\t\tnormal: new Vector3( ),\r\n\t\t\tmaterialIndex: 0\r\n\t\t};\r\n\r\n\t\tTriangle.getNormal( vA, vB, vC, face.normal );\r\n\r\n\t\tintersection.face = face;\r\n\t\tintersection.faceIndex = a;\r\n\r\n\t}\r\n\r\n\treturn intersection;\r\n\r\n}\r\n\r\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L258\r\nfunction intersectTri( mesh, geo, raycaster, ray, tri, intersections ) {\r\n\r\n\tconst triOffset = tri * 3;\r\n\tconst a = geo.index.getX( triOffset );\r\n\tconst b = geo.index.getX( triOffset + 1 );\r\n\tconst c = geo.index.getX( triOffset + 2 );\r\n\r\n\tconst intersection = checkBufferGeometryIntersection( mesh, raycaster, ray, geo.attributes.position, geo.attributes.uv, a, b, c );\r\n\r\n\tif ( intersection ) {\r\n\r\n\t\tintersection.faceIndex = tri;\r\n\t\tif ( intersections ) intersections.push( intersection );\r\n\t\treturn intersection;\r\n\r\n\t}\r\n\r\n\treturn null;\r\n\r\n}\r\n\r\nexport { intersectTri };\r\n"]},"metadata":{},"sourceType":"module"}