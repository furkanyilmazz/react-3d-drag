"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),t=require("react"),r=require("three"),n=require("@react-three/fiber"),i=require("./Environment.cjs.js"),a=require("./ContactShadows.cjs.js");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}require("three-stdlib"),require("use-asset"),require("../helpers/environment-assets.cjs.js"),require("@babel/runtime/helpers/extends");var u=o(e),c=s(t),d=s(r),l={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};exports.Stage=function(e){var t=e.children,r=e.controls,o=e.shadows,s=void 0===o||o,h=e.adjustCamera,f=void 0===h||h,m=e.environment,p=void 0===m?"city":m,b=e.contactShadow,v=void 0===b||b,w=e.intensity,y=void 0===w?1:w,g=e.preset,j=void 0===g?"rembrandt":g,E=e.shadowBias,S=void 0===E?0:E,x=e.contactShadowBlur,q=void 0===x?2:x,O=e.contactShadowOpacity,B=void 0===O?.5:O,L=u.default(e,["children","controls","shadows","adjustCamera","environment","contactShadow","intensity","preset","shadowBias","contactShadowBlur","contactShadowOpacity"]),C=l[j],M=n.useThree((function(e){return e.camera})),P=c.useRef(null),_=c.useRef(null),k=c.useState({radius:0,width:0,height:0}),z=k[0],R=z.radius,W=z.width,A=z.height,D=k[1];return c.useLayoutEffect((function(){P.current.position.set(0,0,0),P.current.updateWorldMatrix(!0,!0);var e=(new d.Box3).setFromObject(_.current),t=new d.Vector3,r=new d.Sphere,n=e.max.y-e.min.y,i=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),D({radius:r.radius,width:i,height:n}),P.current.position.set(-t.x,-t.y+n/2,-t.z)}),[t]),c.useLayoutEffect((function(){if(f){var e=R/(A>W?1.5:2.5);M.position.set(0,.5*R,2.5*R),M.near=.1,M.far=Math.max(5e3,4*R),M.lookAt(0,e,0),r&&r.current&&(r.current.target.set(0,e,0),r.current.update())}}),[R,A,W,f]),c.createElement("group",L,c.createElement("group",{ref:P},c.createElement("group",{ref:_},t)),v&&c.createElement(a.ContactShadows,{"rotation-x":Math.PI/2,opacity:B,width:2*R,height:2*R,blur:q,far:R/2}),p&&c.createElement(i.Environment,{preset:p}),c.createElement("ambientLight",{intensity:y/3}),c.createElement("spotLight",{penumbra:1,position:[C.main[0]*R,C.main[1]*R,C.main[2]*R],intensity:2*y,castShadow:s,"shadow-bias":S}),c.createElement("pointLight",{position:[C.fill[0]*R,C.fill[1]*R,C.fill[2]*R],intensity:y}))};
