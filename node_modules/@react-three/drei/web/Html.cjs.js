"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),r=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),t=require("react"),n=require("react-dom"),o=require("three"),a=require("@react-three/fiber");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var u=i(e),c=i(r),l=s(t),f=s(n),d=new o.Vector3,m=new o.Vector3,p=new o.Vector3;function h(e,r,t){var n=d.setFromMatrixPosition(e.matrixWorld);n.project(r);var o=t.width/2,a=t.height/2;return[n.x*o+o,-n.y*a+a]}var v=function(e){return Math.abs(e)<1e-10?0:e};function x(e,r,t){void 0===t&&(t="");for(var n="matrix3d(",o=0;16!==o;o++)n+=v(r[o]*e.elements[o])+(15!==o?",":")");return t+n}var y,b=(y=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],function(e){return x(e,y)}),g=function(e,r){return x(e,[1/(t=r),1/t,1/t,1,-1/t,-1/t,-1/t,-1,1/t,1/t,1/t,1,1,1,1,1],"translate(-50%,-50%)");var t},M=l.forwardRef((function(e,r){var t,n=e.children,i=e.eps,s=void 0===i?.001:i,x=e.style,y=e.className,M=e.prepend,P=e.center,w=e.fullscreen,W=e.portal,O=e.distanceFactor,j=e.sprite,E=void 0!==j&&j,F=e.transform,T=void 0!==F&&F,C=e.occlude,R=e.onOcclude,z=e.zIndexRange,I=void 0===z?[16777271,0]:z,q=e.calculatePosition,N=void 0===q?h:q,_=e.as,A=void 0===_?"div":_,V=c.default(e,["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","onOcclude","zIndexRange","calculatePosition","as"]),k=a.useThree((function(e){return e.gl})),D=a.useThree((function(e){return e.camera})),L=a.useThree((function(e){return e.scene})),S=a.useThree((function(e){return e.size})),H=a.useThree((function(e){return e.raycaster})),Z=l.useState((function(){return document.createElement(A)}))[0],B=l.useRef(null),G=l.useRef(0),J=l.useRef([0,0]),K=l.useRef(null),Q=l.useRef(null),U=null!==(t=null==W?void 0:W.current)&&void 0!==t?t:k.domElement.parentNode;l.useEffect((function(){if(B.current){if(L.updateMatrixWorld(),T)Z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{var e=N(B.current,D,S);Z.style.cssText="position:absolute;top:0;left:0;transform:translate3d("+e[0]+"px,"+e[1]+"px,0);transform-origin:0 0;"}return U&&(M?U.prepend(Z):U.appendChild(Z)),function(){U&&U.removeChild(Z),f.unmountComponentAtNode(Z)}}}),[U,T]);var X=l.useMemo((function(){return T?{position:"absolute",top:0,left:0,width:S.width,height:S.height,transformStyle:"preserve-3d",pointerEvents:"none"}:u.default({position:"absolute",transform:P?"translate3d(-50%,-50%,0)":"none"},w&&{top:-S.height/2,left:-S.width/2,width:S.width,height:S.height},x)}),[x,P,w,S,T]),Y=l.useMemo((function(){return{position:"absolute",pointerEvents:"auto"}}),[]);l.useLayoutEffect((function(){T?f.render(l.createElement("div",{ref:K,style:X},l.createElement("div",{ref:Q,style:Y},l.createElement("div",{ref:r,className:y,style:x,children:n}))),Z):f.render(l.createElement("div",{ref:r,style:X,className:y,children:n}),Z)}));var $=l.useRef(!0);return a.useFrame((function(){if(B.current){D.updateMatrixWorld();var e=T?J.current:N(B.current,D,S);if(T||Math.abs(G.current-D.zoom)>s||Math.abs(J.current[0]-e[0])>s||Math.abs(J.current[1]-e[1])>s){var r=function(e,r){var t=d.setFromMatrixPosition(e.matrixWorld),n=m.setFromMatrixPosition(r.matrixWorld),o=t.sub(n),a=r.getWorldDirection(p);return o.angleTo(a)>Math.PI/2}(B.current,D),t=!1;"boolean"==typeof C?!0===C&&(t=[L]):Array.isArray(C)&&(t=C.map((function(e){return e.current})));var n=$.current;if(t){var a=function(e,r,t,n){var o=d.setFromMatrixPosition(e.matrixWorld),a=o.clone();a.project(r),t.setFromCamera(a,r);var i=t.intersectObjects(n,!0);if(i.length){var s=i[0].distance;return o.distanceTo(t.ray.origin)<s}return!0}(B.current,D,H,t);$.current=a&&!r}else $.current=!r;if(n!==$.current&&(R?R(!$.current):Z.style.display=$.current?"block":"none"),Z.style.zIndex=""+function(e,r,t){if(r instanceof o.PerspectiveCamera||r instanceof o.OrthographicCamera){var n=d.setFromMatrixPosition(e.matrixWorld),a=m.setFromMatrixPosition(r.matrixWorld),i=n.distanceTo(a),s=(t[1]-t[0])/(r.far-r.near),u=t[1]-s*r.far;return Math.round(s*i+u)}}(B.current,D,I),T){var i=S.width/2,u=S.height/2,c=D.projectionMatrix.elements[5]*u,l=D,f=l.isOrthographicCamera,h=l.top,x=l.left,y=l.bottom,M=l.right,P=b(D.matrixWorldInverse),w=f?"scale("+c+")translate("+v(-(M+x)/2)+"px,"+v((h+y)/2)+"px)":"translateZ("+c+"px)",W=B.current.matrixWorld;E&&((W=D.matrixWorldInverse.clone().transpose().copyPosition(W).scale(B.current.scale)).elements[3]=W.elements[7]=W.elements[11]=0,W.elements[15]=1),Z.style.width=S.width+"px",Z.style.height=S.height+"px",Z.style.perspective=f?"":c+"px",K.current&&Q.current&&(K.current.style.transform=""+w+P+"translate("+i+"px,"+u+"px)",Q.current.style.transform=g(W,1/((O||10)/400)))}else{var j=void 0===O?1:function(e,r){if(r instanceof o.OrthographicCamera)return r.zoom;if(r instanceof o.PerspectiveCamera){var t=d.setFromMatrixPosition(e.matrixWorld),n=m.setFromMatrixPosition(r.matrixWorld),a=r.fov*Math.PI/180,i=t.distanceTo(n);return 1/(2*Math.tan(a/2)*i)}return 1}(B.current,D)*O;Z.style.transform="translate3d("+e[0]+"px,"+e[1]+"px,0) scale("+j+")"}J.current=e,G.current=D.zoom}}})),l.createElement("group",u.default({},V,{ref:B}))}));exports.Html=M;
