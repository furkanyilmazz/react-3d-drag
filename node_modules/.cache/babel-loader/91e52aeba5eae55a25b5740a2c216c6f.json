{"ast":null,"code":"import _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport create from 'zustand';\nimport shallow from 'zustand/shallow';\nimport _construct from '@babel/runtime/helpers/esm/construct';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport _createForOfIteratorHelperLoose from '@babel/runtime/helpers/esm/createForOfIteratorHelperLoose';\nimport { useAsset } from 'use-asset';\nimport _inheritsLoose from '@babel/runtime/helpers/esm/inheritsLoose';\nimport mergeRefs from 'react-merge-refs';\nimport useMeasure from 'react-use-measure';\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a) && typeof a !== 'function';\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nfunction removeInteractivity(store, object) {\n  var _store$getState = store.getState(),\n      internal = _store$getState.internal; // Removes every trace of an object from the data store\n\n\n  internal.interaction = internal.interaction.filter(function (o) {\n    return o !== object;\n  });\n  internal.initialHits = internal.initialHits.filter(function (o) {\n    return o !== object;\n  });\n  internal.hovered.forEach(function (value, key) {\n    if (value.eventObject === object || value.object === object) {\n      internal.hovered.delete(key);\n    }\n  });\n}\n\nfunction createEvents(store) {\n  var temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  function prepareRay(event) {\n    var _raycaster$computeOff;\n\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        mouse = state.mouse,\n        camera = state.camera,\n        size = state.size; // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n\n    var _ref = (_raycaster$computeOff = raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, state)) != null ? _raycaster$computeOff : event,\n        offsetX = _ref.offsetX,\n        offsetY = _ref.offsetY;\n\n    var width = size.width,\n        height = size.height;\n    mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n    raycaster.setFromCamera(mouse, camera);\n  }\n  /** Calculates delta */\n\n\n  function calculateDistance(event) {\n    var _store$getState2 = store.getState(),\n        internal = _store$getState2.internal;\n\n    var dx = event.offsetX - internal.initialClick[0];\n    var dy = event.offsetY - internal.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }\n  /** Returns true if an instance has a valid pointer-event registered, this excludes scroll, clicks etc */\n\n\n  function filterPointerEvents(objects) {\n    return objects.filter(function (obj) {\n      return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n        var _r3f$handlers;\n\n        return (_r3f$handlers = obj.__r3f.handlers) == null ? void 0 : _r3f$handlers['onPointer' + name];\n      });\n    });\n  }\n\n  function intersect(filter) {\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        internal = state.internal; // Skip event handling when noEvents is set\n\n    if (!raycaster.enabled) return [];\n    var seen = new Set();\n    var intersections = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(internal.interaction) : internal.interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = raycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster.filter) intersects = raycaster.filter(intersects, state);\n\n    for (var _iterator = _createForOfIteratorHelperLoose(intersects), _step; !(_step = _iterator()).done;) {\n      var _intersect = _step.value;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var _r3f;\n\n        var handlers = (_r3f = eventObject.__r3f) == null ? void 0 : _r3f.handlers;\n        if (handlers) intersections.push(_extends({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return intersections;\n  }\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n\n  function patchIntersects(intersections, event) {\n    var _store$getState3 = store.getState(),\n        internal = _store$getState3.internal; // If the interaction is captured, make all capturing targets  part of the\n    // intersect.\n\n\n    if ('pointerId' in event && internal.capturedMap.has(event.pointerId)) {\n      intersections.push.apply(intersections, internal.capturedMap.get(event.pointerId).values());\n    }\n\n    return intersections;\n  }\n  /**  Handles intersections by forwarding them to handlers */\n\n\n  function handleIntersects(intersections, event, callback) {\n    var _store$getState4 = store.getState(),\n        raycaster = _store$getState4.raycaster,\n        mouse = _store$getState4.mouse,\n        camera = _store$getState4.camera,\n        internal = _store$getState4.internal; // If anything has been found, forward it to the event listeners\n\n\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(camera);\n        var delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false\n        };\n\n        var _loop = function _loop() {\n          var hit = _step2.value;\n\n          var hasPointerCapture = function hasPointerCapture(id) {\n            var _internal$capturedMap, _internal$capturedMap2;\n\n            return (_internal$capturedMap = (_internal$capturedMap2 = internal.capturedMap.get(id)) == null ? void 0 : _internal$capturedMap2.has(hit.eventObject)) != null ? _internal$capturedMap : false;\n          };\n\n          var setPointerCapture = function setPointerCapture(id) {\n            if (internal.capturedMap.has(id)) {\n              // if the pointerId was previously captured, we add the hit to the\n              // event capturedMap.\n              internal.capturedMap.get(id).set(hit.eventObject, hit);\n            } else {\n              // if the pointerId was not previously captured, we create a map\n              // containing the hitObject, and the hit. hitObject is used for\n              // faster access.\n              internal.capturedMap.set(id, new Map([[hit.eventObject, hit]]));\n            } // Call the original event now\n\n\n            event.target.setPointerCapture(id);\n          }; // Add native event props\n\n\n          var extractEventProps = {};\n\n          for (var prop in Object.getPrototypeOf(event)) {\n            var property = event[prop]; // Only copy over atomics, leave functions alone as these should be\n            // called as event.nativeEvent.fn()\n\n            if (typeof property !== 'function') extractEventProps[prop] = property;\n          }\n\n          var raycastEvent = _extends({}, hit, extractEventProps, {\n            spaceX: mouse.x,\n            spaceY: mouse.y,\n            intersections: intersections,\n            stopped: localState.stopped,\n            delta: delta,\n            unprojectedPoint: unprojectedPoint,\n            ray: raycaster.ray,\n            camera: camera,\n            // Hijack stopPropagation, which just sets a flag\n            stopPropagation: function stopPropagation() {\n              // https://github.com/pmndrs/react-three-fiber/issues/596\n              // Events are not allowed to stop propagation if the pointer has been captured\n              var capturesForPointer = 'pointerId' in event && internal.capturedMap.get(event.pointerId); // We only authorize stopPropagation...\n\n              if ( // ...if this pointer hasn't been captured\n              !capturesForPointer || // ... or if the hit object is capturing the pointer\n              capturesForPointer.has(hit.eventObject)) {\n                raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n                // An event handler is only allowed to flush other handlers if it is hovered itself\n\n                if (internal.hovered.size && Array.from(internal.hovered.values()).find(function (i) {\n                  return i.eventObject === hit.eventObject;\n                })) {\n                  // Objects cannot flush out higher up objects that have already caught the event\n                  var higher = intersections.slice(0, intersections.indexOf(hit));\n                  cancelPointer([].concat(higher, [hit]));\n                }\n              }\n            },\n            // there should be a distinction between target and currentTarget\n            target: {\n              hasPointerCapture: hasPointerCapture,\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            },\n            currentTarget: {\n              hasPointerCapture: hasPointerCapture,\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            },\n            sourceEvent: event,\n            // deprecated\n            nativeEvent: event\n          }); // Call subscribers\n\n\n          callback(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n          if (localState.stopped === true) return \"break\";\n        };\n\n        for (var _iterator2 = _createForOfIteratorHelperLoose(intersections), _step2; !(_step2 = _iterator2()).done;) {\n          var _ret = _loop();\n\n          if (_ret === \"break\") break;\n        }\n      })();\n    }\n\n    return intersections;\n  }\n\n  function cancelPointer(hits) {\n    var _store$getState5 = store.getState(),\n        internal = _store$getState5.internal;\n\n    Array.from(internal.hovered.values()).forEach(function (hoveredObj) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (!hits.length || !hits.find(function (hit) {\n        return hit.object === hoveredObj.object && hit.index === hoveredObj.index;\n      })) {\n        var eventObject = hoveredObj.eventObject;\n        var handlers = eventObject.__r3f.handlers;\n        internal.hovered.delete(makeId(hoveredObj));\n\n        if (handlers) {\n          // Clear out intersects, they are outdated by now\n          var data = _extends({}, hoveredObj, {\n            intersections: hits || []\n          });\n\n          handlers.onPointerOut == null ? void 0 : handlers.onPointerOut(data);\n          handlers.onPointerLeave == null ? void 0 : handlers.onPointerLeave(data);\n        }\n      }\n    });\n  }\n\n  var handlePointer = function handlePointer(name) {\n    // Deal with cancelation\n    switch (name) {\n      case 'onPointerLeave':\n      case 'onPointerCancel':\n        return function () {\n          return cancelPointer([]);\n        };\n\n      case 'onLostPointerCapture':\n        return function (event) {\n          if ('pointerId' in event) {\n            // this will be a problem if one target releases the pointerId\n            // and another one is still keeping it, as the line below\n            // indifferently deletes all capturing references.\n            store.getState().internal.capturedMap.delete(event.pointerId);\n          }\n\n          cancelPointer([]);\n        };\n    } // Any other pointer goes here ...\n\n\n    return function (event) {\n      var _store$getState6 = store.getState(),\n          onPointerMissed = _store$getState6.onPointerMissed,\n          internal = _store$getState6.internal;\n\n      prepareRay(event); // Get fresh intersects\n\n      var isPointerMove = name === 'onPointerMove';\n      var filter = isPointerMove ? filterPointerEvents : undefined;\n      var hits = patchIntersects(intersect(filter), event); // Take care of unhover\n\n      if (isPointerMove) cancelPointer(hits);\n      handleIntersects(hits, event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__r3f.handlers; // Check presence of handlers\n\n        if (!handlers) return;\n\n        if (isPointerMove) {\n          // Move event ...\n          if (handlers.onPointerOver || handlers.onPointerEnter || handlers.onPointerOut || handlers.onPointerLeave) {\n            // When enter or out is present take care of hover-state\n            var id = makeId(data);\n            var hoveredItem = internal.hovered.get(id);\n\n            if (!hoveredItem) {\n              // If the object wasn't previously hovered, book it and call its handler\n              internal.hovered.set(id, data);\n              handlers.onPointerOver == null ? void 0 : handlers.onPointerOver(data);\n              handlers.onPointerEnter == null ? void 0 : handlers.onPointerEnter(data);\n            } else if (hoveredItem.stopped) {\n              // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n              data.stopPropagation();\n            }\n          } // Call mouse move\n\n\n          handlers.onPointerMove == null ? void 0 : handlers.onPointerMove(data);\n        } else {\n          // All other events ...\n          var handler = handlers == null ? void 0 : handlers[name];\n\n          if (handler) {\n            // Forward all events back to their respective handlers with the exception of click events,\n            // which must use the initial target\n            if (name !== 'onClick' && name !== 'onContextMenu' && name !== 'onDoubleClick' || internal.initialHits.includes(eventObject)) {\n              handler(data);\n              pointerMissed(event, internal.interaction.filter(function (object) {\n                return object !== eventObject;\n              }));\n            }\n          }\n        }\n      }); // Save initial coordinates on pointer-down\n\n      if (name === 'onPointerDown') {\n        internal.initialClick = [event.offsetX, event.offsetY];\n        internal.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      } // If a click yields no results, pass it back to the user as a miss\n\n\n      if ((name === 'onClick' || name === 'onContextMenu' || name === 'onDoubleClick') && !hits.length) {\n        if (calculateDistance(event) <= 2) {\n          pointerMissed(event, internal.interaction);\n          if (onPointerMissed) onPointerMissed(event);\n        }\n      }\n    };\n  };\n\n  function pointerMissed(event, objects) {\n    objects.forEach(function (object) {\n      var _r3f$handlers2;\n\n      return (_r3f$handlers2 = object.__r3f.handlers) == null ? void 0 : _r3f$handlers2.onPointerMissed == null ? void 0 : _r3f$handlers2.onPointerMissed(event);\n    });\n  }\n\n  return {\n    handlePointer: handlePointer\n  };\n}\n\nvar _excluded$3 = [\"args\"],\n    _excluded2 = [\"args\"],\n    _excluded3 = [\"args\"]; // Type guard to tell a store from a portal\n\nvar isStore = function isStore(def) {\n  return def && !!def.getState;\n};\n\nvar getContainer = function getContainer(container, child) {\n  var _container$__r3f$root, _container$__r3f;\n\n  return {\n    // If the container is not a root-store then it must be a THREE.Object3D into which part of the\n    // scene is portalled into. Now there can be two variants of this, either that object is part of\n    // the regular jsx tree, in which case it already has __r3f with a valid root attached, or it lies\n    // outside react, in which case we must take the root of the child that is about to be attached to it.\n    root: isStore(container) ? container : (_container$__r3f$root = (_container$__r3f = container.__r3f) == null ? void 0 : _container$__r3f.root) != null ? _container$__r3f$root : child.__r3f.root,\n    // The container is the eventual target into which objects are mounted, it has to be a THREE.Object3D\n    container: isStore(container) ? container.getState().scene : container\n  };\n};\n\nvar DEFAULT = '__default';\nvar EMPTY = {};\nvar FILTER = ['children', 'key', 'ref'];\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, objects));\n}; // Each object in the scene carries a small LocalState descriptor\n\n\nfunction prepare(object, state) {\n  var instance = object;\n\n  if (state != null && state.instance || !instance.__r3f) {\n    instance.__r3f = _extends({\n      root: null,\n      memoizedProps: {},\n      objects: []\n    }, state);\n  }\n\n  return object;\n}\n\nfunction createRenderer(roots) {\n  function applyProps(instance, newProps, oldProps, accumulative) {\n    var _instance$__r3f, _root$getState, _instance$__r3f2;\n\n    if (oldProps === void 0) {\n      oldProps = {};\n    }\n\n    if (accumulative === void 0) {\n      accumulative = false;\n    } // Filter equals, events and reserved props\n\n\n    var localState = (_instance$__r3f = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f : {};\n    var root = localState.root;\n    var rootState = (_root$getState = root == null ? void 0 : root.getState == null ? void 0 : root.getState()) != null ? _root$getState : {};\n    var sameProps = [];\n    var handlers = [];\n    var newMemoizedProps = {};\n    var i = 0;\n    Object.entries(newProps).forEach(function (_ref) {\n      var key = _ref[0],\n          entry = _ref[1]; // we don't want children, ref or key in the memoized props\n\n      if (FILTER.indexOf(key) === -1) {\n        newMemoizedProps[key] = entry;\n      }\n    });\n\n    if (localState.memoizedProps && localState.memoizedProps.args) {\n      newMemoizedProps.args = localState.memoizedProps.args;\n    }\n\n    if (localState.memoizedProps && localState.memoizedProps.attach) {\n      newMemoizedProps.attach = localState.memoizedProps.attach;\n    }\n\n    if (instance.__r3f) {\n      instance.__r3f.memoizedProps = newMemoizedProps;\n    }\n\n    var objectKeys = Object.keys(newProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (is.equ(newProps[objectKeys[i]], oldProps[objectKeys[i]])) {\n        sameProps.push(objectKeys[i]);\n      } // Event-handlers ...\n      //   are functions, that\n      //   start with \"on\", and\n      //   contain the name \"Pointer\", \"Click\", \"DoubleClick\", \"ContextMenu\", or \"Wheel\"\n\n\n      if (is.fun(newProps[objectKeys[i]]) && /^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(objectKeys[i])) {\n        handlers.push(objectKeys[i]);\n      }\n    } // Catch props that existed, but now exist no more ...\n\n\n    var leftOvers = [];\n\n    if (accumulative) {\n      objectKeys = Object.keys(oldProps);\n\n      for (i = 0; i < objectKeys.length; i++) {\n        if (!newProps.hasOwnProperty(objectKeys[i])) {\n          leftOvers.push(objectKeys[i]);\n        }\n      }\n    }\n\n    var toFilter = [].concat(sameProps, FILTER); // Instances use \"object\" as a reserved identifier\n\n    if ((_instance$__r3f2 = instance.__r3f) != null && _instance$__r3f2.instance) toFilter.push('object');\n\n    var filteredProps = _extends({}, newProps); // Removes sameProps and reserved props from newProps\n\n\n    objectKeys = Object.keys(filteredProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (toFilter.indexOf(objectKeys[i]) > -1) {\n        delete filteredProps[objectKeys[i]];\n      }\n    } // Collect all new props\n\n\n    var filteredPropsEntries = Object.entries(filteredProps); // Prepend left-overs so they can be reset or removed\n    // Left-overs must come first!\n\n    for (i = 0; i < leftOvers.length; i++) {\n      if (leftOvers[i] !== 'children') {\n        filteredPropsEntries.unshift([leftOvers[i], DEFAULT + 'remove']);\n      }\n    }\n\n    if (filteredPropsEntries.length > 0) {\n      filteredPropsEntries.forEach(function (_ref2) {\n        var key = _ref2[0],\n            value = _ref2[1];\n\n        if (!handlers.includes(key)) {\n          var currentInstance = instance;\n          var targetProp = currentInstance[key];\n\n          if (key.includes('-')) {\n            var entries = key.split('-');\n            targetProp = entries.reduce(function (acc, key) {\n              return acc[key];\n            }, instance); // If the target is atomic, it forces us to switch the root\n\n            if (!(targetProp && targetProp.set)) {\n              var _entries$reverse = entries.reverse(),\n                  _name = _entries$reverse[0],\n                  reverseEntries = _entries$reverse.slice(1);\n\n              currentInstance = reverseEntries.reverse().reduce(function (acc, key) {\n                return acc[key];\n              }, instance);\n              key = _name;\n            }\n          } // https://github.com/mrdoob/three.js/issues/21209\n          // HMR/fast-refresh relies on the ability to cancel out props, but threejs\n          // has no means to do this. Hence we curate a small collection of value-classes\n          // with their respective constructor/set arguments\n          // For removed props, try to set default values, if possible\n\n\n          if (value === DEFAULT + 'remove') {\n            if (targetProp && targetProp.constructor) {\n              // use the prop constructor to find the default it should be\n              value = new targetProp.constructor(newMemoizedProps.args);\n            } else if (currentInstance.constructor) {\n              // create a blank slate of the instance and copy the particular parameter.\n              // @ts-ignore\n              var defaultClassCall = new currentInstance.constructor(currentInstance.__r3f.memoizedProps.args);\n              value = defaultClassCall[targetProp]; // destory the instance\n\n              if (defaultClassCall.dispose) {\n                defaultClassCall.dispose();\n              }\n            } else {\n              // instance does not have constructor, just set it to 0\n              value = 0;\n            }\n          } // Special treatment for objects with support for set/copy, and layers\n\n\n          if (targetProp && targetProp.set && (targetProp.copy || targetProp instanceof THREE.Layers)) {\n            // If value is an array\n            if (Array.isArray(value)) {\n              if (targetProp.fromArray) {\n                targetProp.fromArray(value);\n              } else {\n                var _targetProp;\n\n                (_targetProp = targetProp).set.apply(_targetProp, value);\n              }\n            } // Test again target.copy(class) next ...\n            else if (targetProp.copy && value && value.constructor && targetProp.constructor.name === value.constructor.name) {\n                targetProp.copy(value);\n              } // If nothing else fits, just set the single value, ignore undefined\n              // https://github.com/react-spring/react-three-fiber/issues/274\n              else if (value !== undefined) {\n                  var isColor = targetProp instanceof THREE.Color; // Allow setting array scalars\n\n                  if (!isColor && targetProp.setScalar) targetProp.setScalar(value); // Layers have no copy function, we must therefore copy the mask property\n                  else if (targetProp instanceof THREE.Layers && value instanceof THREE.Layers) targetProp.mask = value.mask; // Otherwise just set ...\n                    else targetProp.set(value); // Auto-convert sRGB colors, for now ...\n                  // https://github.com/react-spring/react-three-fiber/issues/344\n\n                  if (!rootState.linear && isColor) targetProp.convertSRGBToLinear();\n                } // Else, just overwrite the value\n\n          } else {\n            currentInstance[key] = value; // Auto-convert sRGB textures, for now ...\n            // https://github.com/react-spring/react-three-fiber/issues/344\n\n            if (!rootState.linear && currentInstance[key] instanceof THREE.Texture) currentInstance[key].encoding = THREE.sRGBEncoding;\n          }\n\n          invalidateInstance(instance);\n        }\n      }); // Preemptively delete the instance from the containers interaction\n\n      if (accumulative && root && instance.raycast && localState.handlers) {\n        localState.handlers = undefined;\n        var index = rootState.internal.interaction.indexOf(instance);\n        if (index > -1) rootState.internal.interaction.splice(index, 1);\n      } // Prep interaction handlers\n\n\n      if (handlers.length) {\n        if (accumulative && root && instance.raycast) {\n          rootState.internal.interaction.push(instance);\n        } // Add handlers to the instances handler-map\n\n\n        localState.handlers = handlers.reduce(function (acc, key) {\n          var _extends2;\n\n          return _extends({}, acc, (_extends2 = {}, _extends2[key] = newProps[key], _extends2));\n        }, {});\n      } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n      if (instance.parent) updateInstance(instance);\n    }\n  }\n\n  function invalidateInstance(instance) {\n    var _instance$__r3f3, _instance$__r3f3$root;\n\n    var state = (_instance$__r3f3 = instance.__r3f) == null ? void 0 : (_instance$__r3f3$root = _instance$__r3f3.root) == null ? void 0 : _instance$__r3f3$root.getState == null ? void 0 : _instance$__r3f3$root.getState();\n    if (state && state.internal.frames === 0) state.invalidate();\n  }\n\n  function updateInstance(instance) {\n    instance.onUpdate == null ? void 0 : instance.onUpdate(instance);\n  }\n\n  function createInstance(type, _ref3, root, hostContext, internalInstanceHandle) {\n    var _ref3$args = _ref3.args,\n        args = _ref3$args === void 0 ? [] : _ref3$args,\n        props = _objectWithoutPropertiesLoose(_ref3, _excluded$3);\n\n    var name = \"\" + type[0].toUpperCase() + type.slice(1);\n    var instance; // https://github.com/facebook/react/issues/17147\n    // Portals do not give us a root, they are themselves treated as a root by the reconciler\n    // In order to figure out the actual root we have to climb through fiber internals :(\n\n    if (!isStore(root) && internalInstanceHandle) {\n      var fn = function fn(node) {\n        if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n      };\n\n      root = fn(internalInstanceHandle);\n    } // Assert that by now we have a valid root\n\n\n    if (!root || !isStore(root)) throw \"No valid root for \" + name + \"!\";\n\n    if (type === 'primitive') {\n      if (props.object === undefined) throw \"Primitives without 'object' are invalid!\";\n      var object = props.object;\n      instance = prepare(object, {\n        root: root,\n        instance: true\n      });\n    } else {\n      var target = catalogue[name] || THREE[name];\n      if (!target) throw name + \" is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively\";\n      var isArgsArr = is.arr(args); // Instanciate new object, link it to the root\n\n      instance = prepare(isArgsArr ? _construct(target, args) : new target(args), {\n        root: root,\n        // append memoized props with args so it's not forgotten\n        memoizedProps: {\n          args: isArgsArr && args.length === 0 ? null : args\n        }\n      });\n    } // Auto-attach geometries and materials\n\n\n    if (!('attachFns' in props)) {\n      if (name.endsWith('Geometry')) {\n        props = _extends({\n          attach: 'geometry'\n        }, props);\n      } else if (name.endsWith('Material')) {\n        props = _extends({\n          attach: 'material'\n        }, props);\n      }\n    } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n    // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n    // why it passes \"true\" here\n\n\n    applyProps(instance, props, {});\n    return instance;\n  }\n\n  function appendChild(parentInstance, child) {\n    var addedAsChild = false;\n\n    if (child) {\n      // The attach attribute implies that the object attaches itself on the parent\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = child;\n      } else if (is.arr(child.attachFns)) {\n        var _ref4 = child.attachFns,\n            attachFn = _ref4[0];\n\n        if (is.str(attachFn) && is.fun(parentInstance[attachFn])) {\n          parentInstance[attachFn](child);\n        } else if (is.fun(attachFn)) {\n          attachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D) {\n        // add in the usual parent-child way\n        parentInstance.add(child);\n        addedAsChild = true;\n      }\n\n      if (!addedAsChild) {\n        // This is for anything that used attach, and for non-Object3Ds that don't get attached to props;\n        // that is, anything that's a child in React but not a child in the scenegraph.\n        parentInstance.__r3f.objects.push(child);\n\n        child.parent = parentInstance;\n      }\n\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function insertBefore(parentInstance, child, beforeChild) {\n    var added = false;\n\n    if (child) {\n      if (child.attachArray) {\n        var array = parentInstance[child.attachArray];\n        if (!is.arr(array)) parentInstance[child.attachArray] = [];\n        array.splice(array.indexOf(beforeChild), 0, child);\n      } else if (child.attachObject || child.attach && !is.fun(child.attach)) {\n        // attach and attachObject don't have an order anyway, so just append\n        return appendChild(parentInstance, child);\n      } else if (child.isObject3D) {\n        child.parent = parentInstance;\n        child.dispatchEvent({\n          type: 'added'\n        });\n        var restSiblings = parentInstance.children.filter(function (sibling) {\n          return sibling !== child;\n        });\n        var index = restSiblings.indexOf(beforeChild);\n        parentInstance.children = [].concat(restSiblings.slice(0, index), [child], restSiblings.slice(index));\n        added = true;\n      }\n\n      if (!added) {\n        parentInstance.__r3f.objects.push(child);\n\n        child.parent = parentInstance;\n      }\n\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function removeRecursive(array, parent, dispose) {\n    if (dispose === void 0) {\n      dispose = false;\n    }\n\n    if (array) [].concat(array).forEach(function (child) {\n      return removeChild(parent, child, dispose);\n    });\n  }\n\n  function removeChild(parentInstance, child, dispose) {\n    if (child) {\n      var _child$__r3f2;\n\n      if (parentInstance.__r3f.objects) {\n        var oldLength = parentInstance.__r3f.objects.length;\n        parentInstance.__r3f.objects = parentInstance.__r3f.objects.filter(function (x) {\n          return x !== child;\n        });\n        var newLength = parentInstance.__r3f.objects.length; // was it in the list?\n\n        if (newLength < oldLength) {\n          // we had also set this, so we must clear it now\n          child.parent = null;\n        }\n      } // Remove attachment\n\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n          return x !== child;\n        });\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = null;\n      } else if (is.arr(child.attachFns)) {\n        var _ref5 = child.attachFns,\n            detachFn = _ref5[1];\n\n        if (is.str(detachFn) && is.fun(parentInstance[detachFn])) {\n          parentInstance[detachFn](child);\n        } else if (is.fun(detachFn)) {\n          detachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D) {\n        var _child$__r3f;\n\n        parentInstance.remove(child); // Remove interactivity\n\n        if ((_child$__r3f = child.__r3f) != null && _child$__r3f.root) {\n          removeInteractivity(child.__r3f.root, child);\n        }\n      } // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n      // Never dispose of primitives because their state may be kept outside of React!\n      // In order for an object to be able to dispose it has to have\n      //   - a dispose method,\n      //   - it cannot be an <instance object={...} />\n      //   - it cannot be a THREE.Scene, because three has broken it's own api\n      //\n      // Since disposal is recursive, we can check the optional dispose arg, which will be undefined\n      // when the reconciler calls it, but then carry our own check recursively\n\n\n      var isInstance = (_child$__r3f2 = child.__r3f) == null ? void 0 : _child$__r3f2.instance;\n      var shouldDispose = dispose === undefined ? child.dispose !== null && !isInstance : dispose; // Remove nested child objects. Primitives should not have objects and children that are\n      // attached to them declaratively ...\n\n      if (!isInstance) {\n        var _child$__r3f3;\n\n        removeRecursive((_child$__r3f3 = child.__r3f) == null ? void 0 : _child$__r3f3.objects, child, shouldDispose);\n        removeRecursive(child.children, child, shouldDispose);\n      } // Remove references\n\n\n      if (child.__r3f) {\n        delete child.__r3f.root;\n        delete child.__r3f.objects;\n        delete child.__r3f.handlers;\n        delete child.__r3f.memoizedProps;\n        if (!isInstance) delete child.__r3f;\n      } // Dispose item whenever the reconciler feels like it\n\n\n      if (shouldDispose && child.dispose && child.type !== 'Scene') {\n        unstable_runWithPriority(unstable_IdlePriority, function () {\n          return child.dispose();\n        });\n      }\n\n      invalidateInstance(parentInstance);\n    }\n  }\n\n  function switchInstance(instance, type, newProps, fiber) {\n    var parent = instance.parent;\n    if (!parent) return;\n    var newInstance = createInstance(type, newProps, instance.__r3f.root); // https://github.com/pmndrs/react-three-fiber/issues/1348\n    // When args change the instance has to be re-constructed, which then\n    // forces r3f to re-parent the children and non-scene objects\n\n    if (instance.children) {\n      instance.children.forEach(function (child) {\n        return appendChild(newInstance, child);\n      });\n      instance.children = [];\n    }\n\n    instance.__r3f.objects.forEach(function (child) {\n      return appendChild(newInstance, child);\n    });\n\n    instance.__r3f.objects = [];\n    removeChild(parent, instance);\n    appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n    // https://github.com/facebook/react/issues/14983\n    // https://github.com/facebook/react/pull/15021\n    ;\n    [fiber, fiber.alternate].forEach(function (fiber) {\n      if (fiber !== null) {\n        fiber.stateNode = newInstance;\n\n        if (fiber.ref) {\n          if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n        }\n      }\n    });\n  }\n\n  var reconciler = Reconciler({\n    now: unstable_now,\n    createInstance: createInstance,\n    removeChild: removeChild,\n    appendChild: appendChild,\n    appendInitialChild: appendChild,\n    insertBefore: insertBefore,\n    warnsIfNotActing: true,\n    supportsMutation: true,\n    isPrimaryRenderer: false,\n    // @ts-ignore\n    scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    // @ts-ignore\n    setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    noTimeout: -1,\n    appendChildToContainer: function appendChildToContainer(parentInstance, child) {\n      var _getContainer = getContainer(parentInstance, child),\n          container = _getContainer.container,\n          root = _getContainer.root; // Link current root to the default scene\n\n\n      container.__r3f.root = root;\n      appendChild(container, child);\n    },\n    removeChildFromContainer: function removeChildFromContainer(parentInstance, child) {\n      var _getContainer2 = getContainer(parentInstance, child),\n          container = _getContainer2.container;\n\n      removeChild(container, child);\n    },\n    insertInContainerBefore: function insertInContainerBefore(parentInstance, child, beforeChild) {\n      var _getContainer3 = getContainer(parentInstance, child),\n          container = _getContainer3.container;\n\n      insertBefore(container, child, beforeChild);\n    },\n    commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n      if (instance.__r3f.instance && newProps.object && newProps.object !== instance) {\n        // <instance object={...} /> where the object reference has changed\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // This is a data object, let's extract critical information about it\n        var _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutPropertiesLoose(newProps, _excluded2);\n\n        var _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutPropertiesLoose(oldProps, _excluded3); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n        var hasNewArgs = argsNew.some(function (value, index) {\n          return is.obj(value) ? Object.entries(value).some(function (_ref6) {\n            var key = _ref6[0],\n                val = _ref6[1];\n            return val !== argsOld[index][key];\n          }) : value !== argsOld[index];\n        });\n\n        if (hasNewArgs) {\n          // Next we create a new instance and append it again\n          switchInstance(instance, type, newProps, fiber);\n        } else {\n          // Otherwise just overwrite props\n          applyProps(instance, restNew, restOld, true);\n        }\n      }\n    },\n    hideInstance: function hideInstance(instance) {\n      if (instance.isObject3D) {\n        instance.visible = false;\n        invalidateInstance(instance);\n      }\n    },\n    unhideInstance: function unhideInstance(instance, props) {\n      if (instance.isObject3D && props.visible == null || props.visible) {\n        instance.visible = true;\n        invalidateInstance(instance);\n      }\n    },\n    hideTextInstance: function hideTextInstance() {\n      throw new Error('Text is not allowed in the R3F tree.');\n    },\n    getPublicInstance: function getPublicInstance(instance) {\n      // TODO: might fix switchInstance (?)\n      return instance;\n    },\n    getRootHostContext: function getRootHostContext(rootContainer) {\n      return EMPTY;\n    },\n    getChildHostContext: function getChildHostContext(parentHostContext) {\n      return EMPTY;\n    },\n    createTextInstance: function createTextInstance() {},\n    finalizeInitialChildren: function finalizeInitialChildren(instance) {\n      // https://github.com/facebook/react/issues/20271\n      // Returning true will trigger commitMount\n      return !!instance.__r3f.handlers;\n    },\n    commitMount: function commitMount(instance)\n    /*, type, props*/\n    {\n      // https://github.com/facebook/react/issues/20271\n      // This will make sure events are only added once to the central container\n      if (instance.raycast && instance.__r3f.handlers) instance.__r3f.root.getState().internal.interaction.push(instance);\n    },\n    prepareUpdate: function prepareUpdate() {\n      return EMPTY;\n    },\n    shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n      return false;\n    },\n    prepareForCommit: function prepareForCommit() {\n      return null;\n    },\n    preparePortalMount: function preparePortalMount() {// noop\n    },\n    resetAfterCommit: function resetAfterCommit() {// noop\n    },\n    shouldSetTextContent: function shouldSetTextContent() {\n      return false;\n    },\n    clearContainer: function clearContainer() {\n      return false;\n    }\n  });\n  return {\n    reconciler: reconciler,\n    applyProps: applyProps\n  };\n}\n\nvar _excluded$2 = [\"params\"];\n\nvar isRenderer = function isRenderer(def) {\n  return def && !!def.render;\n};\n\nvar isOrthographicCamera = function isOrthographicCamera(def) {\n  return def && def.isOrthographicCamera;\n};\n\nvar context = /*#__PURE__*/React.createContext(null);\n\nvar createStore = function createStore(applyProps, _invalidate, _advance, props) {\n  var gl = props.gl,\n      size = props.size,\n      _props$shadows = props.shadows,\n      shadows = _props$shadows === void 0 ? false : _props$shadows,\n      _props$linear = props.linear,\n      linear = _props$linear === void 0 ? false : _props$linear,\n      _props$flat = props.flat,\n      flat = _props$flat === void 0 ? false : _props$flat,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$orthographic = props.orthographic,\n      orthographic = _props$orthographic === void 0 ? false : _props$orthographic,\n      _props$frameloop = props.frameloop,\n      frameloop = _props$frameloop === void 0 ? 'always' : _props$frameloop,\n      _props$dpr = props.dpr,\n      dpr = _props$dpr === void 0 ? 1 : _props$dpr,\n      performance = props.performance,\n      _props$clock = props.clock,\n      clock = _props$clock === void 0 ? new THREE.Clock() : _props$clock,\n      raycastOptions = props.raycaster,\n      cameraOptions = props.camera,\n      onPointerMissed = props.onPointerMissed; // Set shadowmap\n\n  if (shadows) {\n    gl.shadowMap.enabled = true;\n    if (typeof shadows === 'object') Object.assign(gl.shadowMap, shadows);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n  } // Set color management\n\n\n  if (!linear) {\n    if (!flat) gl.toneMapping = THREE.ACESFilmicToneMapping;\n    gl.outputEncoding = THREE.sRGBEncoding;\n  } // clock.elapsedTime is updated using advance(timestamp)\n\n\n  if (frameloop === 'never') {\n    clock.stop();\n    clock.elapsedTime = 0;\n  }\n\n  var rootState = create(function (set, get) {\n    // Create custom raycaster\n    var raycaster = new THREE.Raycaster();\n\n    var _ref = raycastOptions || {},\n        params = _ref.params,\n        options = _objectWithoutPropertiesLoose(_ref, _excluded$2);\n\n    applyProps(raycaster, _extends({\n      enabled: true\n    }, options, {\n      params: _extends({}, raycaster.params, params)\n    }), {}); // Create default camera\n\n    var isCamera = cameraOptions instanceof THREE.Camera;\n    var camera = isCamera ? cameraOptions : orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n\n    if (!isCamera) {\n      camera.position.z = 5;\n      if (cameraOptions) applyProps(camera, cameraOptions, {}); // Always look at center by default\n\n      camera.lookAt(0, 0, 0);\n    }\n\n    function _setDpr(dpr) {\n      return Array.isArray(dpr) ? Math.min(Math.max(dpr[0], window.devicePixelRatio), dpr[1]) : dpr;\n    }\n\n    var initialDpr = _setDpr(dpr);\n\n    var position = new THREE.Vector3();\n    var defaultTarget = new THREE.Vector3();\n\n    function getCurrentViewport(camera, target, size) {\n      if (camera === void 0) {\n        camera = get().camera;\n      }\n\n      if (target === void 0) {\n        target = defaultTarget;\n      }\n\n      if (size === void 0) {\n        size = get().size;\n      }\n\n      var _size = size,\n          width = _size.width,\n          height = _size.height;\n      var aspect = width / height;\n      var distance = camera.getWorldPosition(position).distanceTo(target);\n\n      if (isOrthographicCamera(camera)) {\n        return {\n          width: width / camera.zoom,\n          height: height / camera.zoom,\n          factor: 1,\n          distance: distance,\n          aspect: aspect\n        };\n      } else {\n        var fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n        var h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n        var w = h * (width / height);\n        return {\n          width: w,\n          height: h,\n          factor: width / w,\n          distance: distance,\n          aspect: aspect\n        };\n      }\n    }\n\n    var performanceTimeout = undefined;\n\n    var setPerformanceCurrent = function setPerformanceCurrent(current) {\n      return set(function (state) {\n        return {\n          performance: _extends({}, state.performance, {\n            current: current\n          })\n        };\n      });\n    };\n\n    return {\n      gl: gl,\n      set: set,\n      get: get,\n      invalidate: function invalidate() {\n        return _invalidate(get());\n      },\n      advance: function advance(timestamp, runGlobalEffects) {\n        return _advance(timestamp, runGlobalEffects, get());\n      },\n      linear: linear,\n      flat: flat,\n      scene: prepare(new THREE.Scene()),\n      camera: camera,\n      controls: null,\n      raycaster: raycaster,\n      clock: clock,\n      mouse: new THREE.Vector2(),\n      vr: vr,\n      frameloop: frameloop,\n      onPointerMissed: onPointerMissed,\n      performance: _extends({\n        current: 1,\n        min: 0.5,\n        max: 1,\n        debounce: 200\n      }, performance, {\n        regress: function regress() {\n          var state = get(); // Clear timeout\n\n          if (performanceTimeout) clearTimeout(performanceTimeout); // Set lower bound performance\n\n          if (state.performance.current !== state.performance.min) setPerformanceCurrent(state.performance.min); // Go back to upper bound performance after a while unless something regresses meanwhile\n\n          performanceTimeout = setTimeout(function () {\n            return setPerformanceCurrent(get().performance.max);\n          }, state.performance.debounce);\n        }\n      }),\n      size: {\n        width: 0,\n        height: 0\n      },\n      viewport: {\n        initialDpr: initialDpr,\n        dpr: initialDpr,\n        width: 0,\n        height: 0,\n        aspect: 0,\n        distance: 0,\n        factor: 0,\n        getCurrentViewport: getCurrentViewport\n      },\n      setSize: function setSize(width, height) {\n        var size = {\n          width: width,\n          height: height\n        };\n        set(function (state) {\n          return {\n            size: size,\n            viewport: _extends({}, state.viewport, getCurrentViewport(camera, defaultTarget, size))\n          };\n        });\n      },\n      setDpr: function setDpr(dpr) {\n        return set(function (state) {\n          return {\n            viewport: _extends({}, state.viewport, {\n              dpr: _setDpr(dpr)\n            })\n          };\n        });\n      },\n      events: {\n        connected: false\n      },\n      internal: {\n        active: false,\n        priority: 0,\n        frames: 0,\n        lastProps: props,\n        interaction: [],\n        hovered: new Map(),\n        subscribers: [],\n        initialClick: [0, 0],\n        initialHits: [],\n        capturedMap: new Map(),\n        subscribe: function subscribe(ref, priority) {\n          if (priority === void 0) {\n            priority = 0;\n          }\n\n          set(function (_ref2) {\n            var internal = _ref2.internal;\n            return {\n              internal: _extends({}, internal, {\n                // If this subscription was given a priority, it takes rendering into its own hands\n                // For that reason we switch off automatic rendering and increase the manual flag\n                // As long as this flag is positive (there could be multiple render subscription)\n                // ..there can be no internal rendering at all\n                priority: internal.priority + (priority > 0 ? 1 : 0),\n                // Register subscriber and sort layers from lowest to highest, meaning,\n                // highest priority renders last (on top of the other frames)\n                subscribers: [].concat(internal.subscribers, [{\n                  ref: ref,\n                  priority: priority\n                }]).sort(function (a, b) {\n                  return a.priority - b.priority;\n                })\n              })\n            };\n          });\n          return function () {\n            set(function (_ref3) {\n              var internal = _ref3.internal;\n              return {\n                internal: _extends({}, internal, {\n                  // Decrease manual flag if this subscription had a priority\n                  priority: internal.priority - (priority > 0 ? 1 : 0),\n                  // Remove subscriber from list\n                  subscribers: internal.subscribers.filter(function (s) {\n                    return s.ref !== ref;\n                  })\n                })\n              };\n            });\n          };\n        }\n      }\n    };\n  }); // Resize camera and renderer on changes to size and pixelratio\n\n  rootState.subscribe(function () {\n    var _rootState$getState = rootState.getState(),\n        camera = _rootState$getState.camera,\n        size = _rootState$getState.size,\n        viewport = _rootState$getState.viewport,\n        internal = _rootState$getState.internal; // https://github.com/pmndrs/react-three-fiber/issues/92\n    // Do not mess with the camera if it belongs to the user\n\n\n    if (!(internal.lastProps.camera instanceof THREE.Camera)) {\n      if (isOrthographicCamera(camera)) {\n        camera.left = size.width / -2;\n        camera.right = size.width / 2;\n        camera.top = size.height / 2;\n        camera.bottom = size.height / -2;\n      } else {\n        camera.aspect = size.width / size.height;\n      }\n\n      camera.updateProjectionMatrix(); // https://github.com/pmndrs/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      camera.updateMatrixWorld();\n    } // Update renderer\n\n\n    gl.setPixelRatio(viewport.dpr);\n    gl.setSize(size.width, size.height);\n  }, function (state) {\n    return [state.viewport.dpr, state.size];\n  }, shallow);\n  var state = rootState.getState(); // Update size\n\n  if (size) state.setSize(size.width, size.height); // Invalidate on any change\n\n  rootState.subscribe(function (state) {\n    return _invalidate(state);\n  }); // Return root state\n\n  return rootState;\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar i;\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\n\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\n\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\n\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\n\nfunction run(effects, timestamp) {\n  for (i = 0; i < effects.length; i++) {\n    effects[i](timestamp);\n  }\n}\n\nfunction render$1(timestamp, state) {\n  // Run local effects\n  var delta = state.clock.getDelta(); // In frameloop='never' mode, clock times are updated using the provided timestamp\n\n  if (state.frameloop === 'never' && typeof timestamp === 'number') {\n    delta = timestamp - state.clock.elapsedTime;\n    state.clock.oldTime = state.clock.elapsedTime;\n    state.clock.elapsedTime = timestamp;\n  } // Call subscribers (useFrame)\n\n\n  for (i = 0; i < state.internal.subscribers.length; i++) {\n    state.internal.subscribers[i].ref.current(state, delta);\n  } // Render content\n\n\n  if (!state.internal.priority && state.gl.render) state.gl.render(state.scene, state.camera); // Decrease frame count\n\n  state.internal.frames = Math.max(0, state.internal.frames - 1);\n  return state.frameloop === 'always' ? 1 : state.internal.frames;\n}\n\nfunction createLoop(roots) {\n  var running = false;\n  var repeat;\n\n  function loop(timestamp) {\n    running = true;\n    repeat = 0; // Run effects\n\n    run(globalEffects, timestamp); // Render all roots\n\n    roots.forEach(function (root) {\n      var state = root.store.getState(); // If the frameloop is invalidated, do not run another frame\n\n      if (state.internal.active && (state.frameloop === 'always' || state.internal.frames > 0)) repeat += render$1(timestamp, state);\n    }); // Run after-effects\n\n    run(globalAfterEffects, timestamp); // Keep on looping if anything invalidates the frameloop\n\n    if (repeat > 0) return requestAnimationFrame(loop); // Tail call effects, they are called when rendering stops\n    else run(globalTailEffects, timestamp); // Flag end of operation\n\n    running = false;\n  }\n\n  function invalidate(state) {\n    if (!state) return roots.forEach(function (root) {\n      return invalidate(root.store.getState());\n    });\n    if (state.vr || !state.internal.active || state.frameloop === 'never') return; // Increase frames, do not go higher than 60\n\n    state.internal.frames = Math.min(60, state.internal.frames + 1); // If the render-loop isn't active, start it\n\n    if (!running) {\n      running = true;\n      requestAnimationFrame(loop);\n    }\n  }\n\n  function advance(timestamp, runGlobalEffects, state) {\n    if (runGlobalEffects === void 0) {\n      runGlobalEffects = true;\n    }\n\n    if (runGlobalEffects) run(globalEffects, timestamp);\n    if (!state) roots.forEach(function (root) {\n      return render$1(timestamp, root.store.getState());\n    });else render$1(timestamp, state);\n    if (runGlobalEffects) run(globalAfterEffects, timestamp);\n  }\n\n  return {\n    loop: loop,\n    invalidate: invalidate,\n    advance: advance\n  };\n}\n\nfunction createPointerEvents(store) {\n  var _createEvents = createEvents(store),\n      handlePointer = _createEvents.handlePointer;\n\n  var names = {\n    onClick: ['click', false],\n    onContextMenu: ['contextmenu', false],\n    onDoubleClick: ['dblclick', false],\n    onWheel: ['wheel', true],\n    onPointerDown: ['pointerdown', true],\n    onPointerUp: ['pointerup', true],\n    onPointerLeave: ['pointerleave', true],\n    onPointerMove: ['pointermove', true],\n    onPointerCancel: ['pointercancel', true],\n    onLostPointerCapture: ['lostpointercapture', true]\n  };\n  return {\n    connected: false,\n    handlers: Object.keys(names).reduce(function (acc, key) {\n      var _extends2;\n\n      return _extends({}, acc, (_extends2 = {}, _extends2[key] = handlePointer(key), _extends2));\n    }, {}),\n    connect: function connect(target) {\n      var _events$handlers;\n\n      var _store$getState = store.getState(),\n          set = _store$getState.set,\n          events = _store$getState.events;\n\n      events.disconnect == null ? void 0 : events.disconnect();\n      set(function (state) {\n        return {\n          events: _extends({}, state.events, {\n            connected: target\n          })\n        };\n      });\n      Object.entries((_events$handlers = events == null ? void 0 : events.handlers) != null ? _events$handlers : []).forEach(function (_ref) {\n        var name = _ref[0],\n            event = _ref[1];\n        var _names = names[name],\n            eventName = _names[0],\n            passive = _names[1];\n        target.addEventListener(eventName, event, {\n          passive: passive\n        });\n      });\n    },\n    disconnect: function disconnect() {\n      var _store$getState2 = store.getState(),\n          set = _store$getState2.set,\n          events = _store$getState2.events;\n\n      if (events.connected) {\n        var _events$handlers2;\n\n        Object.entries((_events$handlers2 = events.handlers) != null ? _events$handlers2 : []).forEach(function (_ref2) {\n          var name = _ref2[0],\n              event = _ref2[1];\n\n          if (events && events.connected instanceof HTMLElement) {\n            var _names2 = names[name],\n                eventName = _names2[0];\n            events.connected.removeEventListener(eventName, event);\n          }\n        });\n        set(function (state) {\n          return {\n            events: _extends({}, state.events, {\n              connected: false\n            })\n          };\n        });\n      }\n    }\n  };\n}\n\nvar _excluded$1 = [\"children\", \"fallback\", \"tabIndex\", \"resize\", \"id\", \"style\", \"className\", \"events\"]; // React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser.\n\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\n\nfunction Block(_ref) {\n  var set = _ref.set;\n  useIsomorphicLayoutEffect(function () {\n    set(new Promise(function () {\n      return null;\n    }));\n    return function () {\n      return set(false);\n    };\n  }, []);\n  return null;\n}\n\nvar ErrorBoundary = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(ErrorBoundary, _React$Component);\n\n  function ErrorBoundary() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;\n    _this.state = {\n      error: false\n    };\n    return _this;\n  }\n\n  var _proto = ErrorBoundary.prototype;\n\n  _proto.componentDidCatch = function componentDidCatch(error) {\n    this.props.set(error);\n  };\n\n  _proto.render = function render() {\n    return this.state.error ? null : this.props.children;\n  };\n\n  return ErrorBoundary;\n}(React.Component);\n\nErrorBoundary.getDerivedStateFromError = function () {\n  return {\n    error: true\n  };\n};\n\nvar Canvas = /*#__PURE__*/React.forwardRef(function Canvas(_ref2, forwardedRef) {\n  var children = _ref2.children,\n      fallback = _ref2.fallback,\n      tabIndex = _ref2.tabIndex,\n      resize = _ref2.resize,\n      id = _ref2.id,\n      style = _ref2.style,\n      className = _ref2.className,\n      events = _ref2.events,\n      props = _objectWithoutPropertiesLoose(_ref2, _excluded$1);\n\n  var _useMeasure = useMeasure(_extends({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    }\n  }, resize)),\n      containerRef = _useMeasure[0],\n      size = _useMeasure[1];\n\n  var canvasRef = React.useRef(null);\n\n  var _React$useState = React.useState(false),\n      block = _React$useState[0],\n      setBlock = _React$useState[1];\n\n  var _React$useState2 = React.useState(false),\n      error = _React$useState2[0],\n      setError = _React$useState2[1]; // Suspend this component if block is a promise (2nd run)\n\n\n  if (block) throw block; // Throw exception outwards if anything within canvas throws\n\n  if (error) throw error; // Execute JSX in the reconciler as a layout-effect\n\n  useIsomorphicLayoutEffect(function () {\n    if (size.width > 0 && size.height > 0) {\n      render( /*#__PURE__*/React.createElement(ErrorBoundary, {\n        set: setError\n      }, /*#__PURE__*/React.createElement(React.Suspense, {\n        fallback: /*#__PURE__*/React.createElement(Block, {\n          set: setBlock\n        })\n      }, children)), canvasRef.current, _extends({}, props, {\n        size: size,\n        events: events || createPointerEvents\n      }));\n    }\n  }, [size, children]);\n  useIsomorphicLayoutEffect(function () {\n    var container = canvasRef.current;\n    return function () {\n      return unmountComponentAtNode(container);\n    };\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: containerRef,\n    id: id,\n    className: className,\n    tabIndex: tabIndex,\n    style: _extends({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }, /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: mergeRefs([canvasRef, forwardedRef]),\n    style: {\n      display: 'block'\n    }\n  }, fallback));\n});\n\nfunction useThree(selector, equalityFn) {\n  if (selector === void 0) {\n    selector = function selector(state) {\n      return state;\n    };\n  }\n\n  var useStore = React.useContext(context);\n  if (!useStore) throw \"R3F hooks can only be used within the Canvas component!\";\n  return useStore(selector, equalityFn);\n}\n\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var subscribe = React.useContext(context).getState().internal.subscribe; // Update ref\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useLayoutEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction buildGraph(object) {\n  var data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(function (obj) {\n      if (obj.name) {\n        data.nodes[obj.name] = obj;\n      }\n\n      if (obj.material && !data.materials[obj.material.name]) {\n        data.materials[obj.material.name] = obj.material;\n      }\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(function () {\n    return buildGraph(object);\n  }, [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto) {\n    // Construct new loader and run extensions\n    var loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    for (var _len = arguments.length, input = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      input[_key - 1] = arguments[_key];\n    }\n\n    return Promise.all(input.map(function (input) {\n      return new Promise(function (res, reject) {\n        return loader.load(input, function (data) {\n          if (data.scene) Object.assign(data, buildGraph(data.scene));\n          res(data);\n        }, onProgress, function (error) {\n          return reject(\"Could not load \" + input + \": \" + error.message);\n        });\n      });\n    }));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  var keys = Array.isArray(input) ? input : [input];\n  var results = useAsset.apply(void 0, [loadingFn(extensions, onProgress), Proto].concat(keys)); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  var keys = Array.isArray(input) ? input : [input];\n  return useAsset.preload.apply(useAsset, [loadingFn(extensions), Proto].concat(keys));\n};\n\nvar _excluded = [\"gl\", \"size\", \"mode\", \"events\", \"onCreated\"];\nvar roots = new Map();\nvar modes = ['legacy', 'blocking', 'concurrent'];\n\nvar _createLoop = createLoop(roots),\n    invalidate = _createLoop.invalidate,\n    advance = _createLoop.advance;\n\nvar _createRenderer = createRenderer(),\n    reconciler = _createRenderer.reconciler,\n    applyProps = _createRenderer.applyProps;\n\nvar createRendererInstance = function createRendererInstance(gl, canvas) {\n  return isRenderer(gl) ? gl : new THREE.WebGLRenderer(_extends({\n    powerPreference: 'high-performance',\n    canvas: canvas,\n    antialias: true,\n    alpha: true\n  }, gl));\n};\n\nfunction render(element, canvas, _temp) {\n  var _store;\n\n  var _ref = _temp === void 0 ? {} : _temp,\n      gl = _ref.gl,\n      size = _ref.size,\n      _ref$mode = _ref.mode,\n      mode = _ref$mode === void 0 ? modes[1] : _ref$mode,\n      events = _ref.events,\n      onCreated = _ref.onCreated,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded); // Allow size to take on container bounds initially\n\n\n  if (!size) {\n    var _canvas$parentElement, _canvas$parentElement2, _canvas$parentElement3, _canvas$parentElement4;\n\n    size = {\n      width: (_canvas$parentElement = (_canvas$parentElement2 = canvas.parentElement) == null ? void 0 : _canvas$parentElement2.clientWidth) != null ? _canvas$parentElement : 0,\n      height: (_canvas$parentElement3 = (_canvas$parentElement4 = canvas.parentElement) == null ? void 0 : _canvas$parentElement4.clientHeight) != null ? _canvas$parentElement3 : 0\n    };\n  }\n\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n  var store = root == null ? void 0 : root.store;\n  var state = (_store = store) == null ? void 0 : _store.getState();\n\n  if (fiber && state) {\n    var lastProps = state.internal.lastProps; // When a root was found, see if any fundamental props must be changed or exchanged\n    // Check pixelratio\n\n    if (props.dpr !== undefined && !is.equ(lastProps.dpr, props.dpr)) state.setDpr(props.dpr); // Check size\n\n    if (!is.equ(lastProps.size, size)) state.setSize(size.width, size.height); // For some props we want to reset the entire root\n    // Changes to the color-space\n\n    var linearChanged = props.linear !== lastProps.linear;\n\n    if (linearChanged) {\n      unmountComponentAtNode(canvas);\n      fiber = undefined;\n    }\n  }\n\n  if (!fiber) {\n    // If no root has been found, make one\n    // Create gl\n    var glRenderer = createRendererInstance(gl, canvas); // Enable VR if requested\n\n    if (props.vr) {\n      glRenderer.xr.enabled = true;\n      glRenderer.setAnimationLoop(function (timestamp) {\n        return advance(timestamp, true);\n      });\n    } // Create store\n\n\n    store = createStore(applyProps, invalidate, advance, _extends({\n      gl: glRenderer,\n      size: size\n    }, props));\n\n    var _state = store.getState(); // Create renderer\n\n\n    fiber = reconciler.createContainer(store, modes.indexOf(mode), false, null); // Map it\n\n    roots.set(canvas, {\n      fiber: fiber,\n      store: store\n    }); // Store events internally\n\n    if (events) _state.set({\n      events: events(store)\n    });\n  }\n\n  if (store && fiber) {\n    reconciler.updateContainer( /*#__PURE__*/React.createElement(Provider, {\n      store: store,\n      element: element,\n      onCreated: onCreated,\n      target: canvas\n    }), fiber, null, function () {\n      return undefined;\n    });\n    return store;\n  } else {\n    throw 'Error creating root!';\n  }\n}\n\nfunction Provider(_ref2) {\n  var store = _ref2.store,\n      element = _ref2.element,\n      onCreated = _ref2.onCreated,\n      target = _ref2.target;\n  React.useEffect(function () {\n    var state = store.getState(); // Flag the canvas active, rendering will now begin\n\n    state.set(function (state) {\n      return {\n        internal: _extends({}, state.internal, {\n          active: true\n        })\n      };\n    }); // Connect events\n\n    state.events.connect == null ? void 0 : state.events.connect(target); // Notifiy that init is completed, the scene graph exists, but nothing has yet rendered\n\n    if (onCreated) onCreated(state);\n  }, []);\n  return /*#__PURE__*/React.createElement(context.Provider, {\n    value: store\n  }, element);\n}\n\nfunction unmountComponentAtNode(canvas, callback) {\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n\n  if (fiber) {\n    var _state2 = root == null ? void 0 : root.store.getState();\n\n    if (_state2) _state2.internal.active = false;\n    reconciler.updateContainer(null, fiber, null, function () {\n      if (_state2) {\n        setTimeout(function () {\n          var _state2$gl, _state2$gl$renderList, _state2$gl2;\n\n          _state2.events.disconnect == null ? void 0 : _state2.events.disconnect();\n          (_state2$gl = _state2.gl) == null ? void 0 : (_state2$gl$renderList = _state2$gl.renderLists) == null ? void 0 : _state2$gl$renderList.dispose == null ? void 0 : _state2$gl$renderList.dispose();\n          (_state2$gl2 = _state2.gl) == null ? void 0 : _state2$gl2.forceContextLoss == null ? void 0 : _state2$gl2.forceContextLoss();\n          dispose(_state2);\n          roots.delete(canvas);\n          if (callback) callback(canvas);\n        }, 500);\n      }\n    });\n  }\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (var p in obj) {\n    var _dispose, _ref3;\n\n    (_dispose = (_ref3 = p).dispose) == null ? void 0 : _dispose.call(_ref3);\n    delete obj[p];\n  }\n}\n\nvar act = reconciler.act;\nvar hasSymbol = is.fun(Symbol) && Symbol.for;\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction createPortal(children, container, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: prepare(container),\n    implementation: implementation\n  };\n}\n\nreconciler.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  rendererPackageName: '@react-three/fiber',\n  version: '17.0.2'\n});\nexport { Canvas, threeTypes as ReactThreeFiber, roots as _roots, act, addAfterEffect, addEffect, addTail, advance, applyProps, context, createPortal, dispose, createPointerEvents as events, extend, invalidate, reconciler, render, unmountComponentAtNode, useFrame, useGraph, useLoader, useThree };","map":{"version":3,"sources":["/Users/a2017/Documents/GitHub/react-3d-drag/node_modules/@react-three/fiber/dist/react-three-fiber.esm.js"],"names":["_objectWithoutPropertiesLoose","_extends","THREE","React","create","shallow","_construct","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","_createForOfIteratorHelperLoose","useAsset","_inheritsLoose","mergeRefs","useMeasure","threeTypes","Object","freeze","__proto__","is","obj","a","arr","fun","str","num","und","Array","isArray","equ","b","i","makeId","event","eventObject","object","uuid","index","removeInteractivity","store","_store$getState","getState","internal","interaction","filter","o","initialHits","hovered","forEach","value","key","delete","createEvents","temp","Vector3","prepareRay","_raycaster$computeOff","state","raycaster","mouse","camera","size","_ref","computeOffsets","offsetX","offsetY","width","height","set","setFromCamera","calculateDistance","_store$getState2","dx","initialClick","dy","Math","round","sqrt","filterPointerEvents","objects","some","name","_r3f$handlers","__r3f","handlers","intersect","enabled","seen","Set","intersections","eventsObjects","intersects","intersectObjects","item","id","has","add","_iterator","_step","done","_intersect","_r3f","push","parent","patchIntersects","_store$getState3","capturedMap","pointerId","apply","get","values","handleIntersects","callback","_store$getState4","length","unprojectedPoint","x","y","unproject","delta","type","releasePointerCapture","target","localState","stopped","_loop","hit","_step2","hasPointerCapture","_internal$capturedMap","_internal$capturedMap2","setPointerCapture","Map","extractEventProps","prop","getPrototypeOf","property","raycastEvent","spaceX","spaceY","ray","stopPropagation","capturesForPointer","from","find","higher","slice","indexOf","cancelPointer","concat","currentTarget","sourceEvent","nativeEvent","_iterator2","_ret","hits","_store$getState5","hoveredObj","data","onPointerOut","onPointerLeave","handlePointer","_store$getState6","onPointerMissed","isPointerMove","undefined","onPointerOver","onPointerEnter","hoveredItem","onPointerMove","handler","includes","pointerMissed","map","_r3f$handlers2","_excluded$3","_excluded2","_excluded3","isStore","def","getContainer","container","child","_container$__r3f$root","_container$__r3f","root","scene","DEFAULT","EMPTY","FILTER","catalogue","extend","prepare","instance","memoizedProps","createRenderer","roots","applyProps","newProps","oldProps","accumulative","_instance$__r3f","_root$getState","_instance$__r3f2","rootState","sameProps","newMemoizedProps","entries","entry","args","attach","objectKeys","keys","test","leftOvers","hasOwnProperty","toFilter","filteredProps","filteredPropsEntries","unshift","_ref2","currentInstance","targetProp","split","reduce","acc","_entries$reverse","reverse","_name","reverseEntries","constructor","defaultClassCall","dispose","copy","Layers","fromArray","_targetProp","isColor","Color","setScalar","mask","linear","convertSRGBToLinear","Texture","encoding","sRGBEncoding","invalidateInstance","raycast","splice","_extends2","updateInstance","_instance$__r3f3","_instance$__r3f3$root","frames","invalidate","onUpdate","createInstance","_ref3","hostContext","internalInstanceHandle","_ref3$args","props","toUpperCase","fn","node","return","stateNode","containerInfo","isArgsArr","endsWith","appendChild","parentInstance","addedAsChild","attachArray","attachObject","attachFns","_ref4","attachFn","isObject3D","insertBefore","beforeChild","added","array","dispatchEvent","restSiblings","children","sibling","removeRecursive","removeChild","_child$__r3f2","oldLength","newLength","_ref5","detachFn","_child$__r3f","remove","isInstance","shouldDispose","_child$__r3f3","switchInstance","fiber","newInstance","alternate","ref","current","reconciler","now","appendInitialChild","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendChildToContainer","_getContainer","removeChildFromContainer","_getContainer2","insertInContainerBefore","_getContainer3","commitUpdate","updatePayload","_newProps$args","argsNew","restNew","_oldProps$args","argsOld","restOld","hasNewArgs","_ref6","val","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","rootContainer","getChildHostContext","parentHostContext","createTextInstance","finalizeInitialChildren","commitMount","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","preparePortalMount","resetAfterCommit","shouldSetTextContent","clearContainer","_excluded$2","isRenderer","render","isOrthographicCamera","context","createContext","createStore","_invalidate","_advance","gl","_props$shadows","shadows","_props$linear","_props$flat","flat","_props$vr","vr","_props$orthographic","orthographic","_props$frameloop","frameloop","_props$dpr","dpr","performance","_props$clock","clock","Clock","raycastOptions","cameraOptions","shadowMap","assign","PCFSoftShadowMap","toneMapping","ACESFilmicToneMapping","outputEncoding","stop","elapsedTime","Raycaster","params","options","isCamera","Camera","OrthographicCamera","PerspectiveCamera","position","z","lookAt","_setDpr","min","max","window","devicePixelRatio","initialDpr","defaultTarget","getCurrentViewport","_size","aspect","distance","getWorldPosition","distanceTo","zoom","factor","fov","PI","h","tan","w","performanceTimeout","setPerformanceCurrent","advance","timestamp","runGlobalEffects","Scene","controls","Vector2","debounce","regress","viewport","setSize","setDpr","events","connected","active","priority","lastProps","subscribers","subscribe","sort","s","_rootState$getState","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setPixelRatio","createSubs","subs","globalEffects","globalAfterEffects","globalTailEffects","addEffect","addAfterEffect","addTail","run","effects","render$1","getDelta","oldTime","createLoop","running","repeat","loop","requestAnimationFrame","createPointerEvents","_createEvents","names","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerCancel","onLostPointerCapture","connect","_events$handlers","disconnect","_names","eventName","passive","addEventListener","_events$handlers2","HTMLElement","_names2","removeEventListener","_excluded$1","useIsomorphicLayoutEffect","useLayoutEffect","useEffect","Block","Promise","ErrorBoundary","_React$Component","_this","_len","arguments","_key","call","error","_proto","prototype","componentDidCatch","Component","getDerivedStateFromError","Canvas","forwardRef","forwardedRef","fallback","tabIndex","resize","style","className","_useMeasure","scroll","containerRef","canvasRef","useRef","_React$useState","useState","block","setBlock","_React$useState2","setError","createElement","Suspense","unmountComponentAtNode","overflow","display","useThree","selector","equalityFn","useStore","useContext","useFrame","renderPriority","unsubscribe","buildGraph","nodes","materials","traverse","material","useGraph","useMemo","loadingFn","extensions","onProgress","Proto","loader","input","all","res","reject","load","message","useLoader","results","preload","_excluded","modes","_createLoop","_createRenderer","createRendererInstance","canvas","WebGLRenderer","powerPreference","antialias","alpha","element","_temp","_store","_ref$mode","mode","onCreated","_canvas$parentElement","_canvas$parentElement2","_canvas$parentElement3","_canvas$parentElement4","parentElement","clientWidth","clientHeight","linearChanged","glRenderer","xr","setAnimationLoop","_state","createContainer","updateContainer","Provider","_state2","_state2$gl","_state2$gl$renderList","_state2$gl2","renderLists","forceContextLoss","p","_dispose","act","hasSymbol","Symbol","for","REACT_PORTAL_TYPE","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","rendererPackageName","version","ReactThreeFiber","_roots"],"mappings":"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","sourcesContent":["import _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport create from 'zustand';\nimport shallow from 'zustand/shallow';\nimport _construct from '@babel/runtime/helpers/esm/construct';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport _createForOfIteratorHelperLoose from '@babel/runtime/helpers/esm/createForOfIteratorHelperLoose';\nimport { useAsset } from 'use-asset';\nimport _inheritsLoose from '@babel/runtime/helpers/esm/inheritsLoose';\nimport mergeRefs from 'react-merge-refs';\nimport useMeasure from 'react-use-measure';\n\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a) && typeof a !== 'function';\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nfunction removeInteractivity(store, object) {\n  var _store$getState = store.getState(),\n      internal = _store$getState.internal; // Removes every trace of an object from the data store\n\n\n  internal.interaction = internal.interaction.filter(function (o) {\n    return o !== object;\n  });\n  internal.initialHits = internal.initialHits.filter(function (o) {\n    return o !== object;\n  });\n  internal.hovered.forEach(function (value, key) {\n    if (value.eventObject === object || value.object === object) {\n      internal.hovered.delete(key);\n    }\n  });\n}\nfunction createEvents(store) {\n  var temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  function prepareRay(event) {\n    var _raycaster$computeOff;\n\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        mouse = state.mouse,\n        camera = state.camera,\n        size = state.size; // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n\n    var _ref = (_raycaster$computeOff = raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, state)) != null ? _raycaster$computeOff : event,\n        offsetX = _ref.offsetX,\n        offsetY = _ref.offsetY;\n\n    var width = size.width,\n        height = size.height;\n    mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n    raycaster.setFromCamera(mouse, camera);\n  }\n  /** Calculates delta */\n\n\n  function calculateDistance(event) {\n    var _store$getState2 = store.getState(),\n        internal = _store$getState2.internal;\n\n    var dx = event.offsetX - internal.initialClick[0];\n    var dy = event.offsetY - internal.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }\n  /** Returns true if an instance has a valid pointer-event registered, this excludes scroll, clicks etc */\n\n\n  function filterPointerEvents(objects) {\n    return objects.filter(function (obj) {\n      return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n        var _r3f$handlers;\n\n        return (_r3f$handlers = obj.__r3f.handlers) == null ? void 0 : _r3f$handlers['onPointer' + name];\n      });\n    });\n  }\n\n  function intersect(filter) {\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        internal = state.internal; // Skip event handling when noEvents is set\n\n    if (!raycaster.enabled) return [];\n    var seen = new Set();\n    var intersections = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(internal.interaction) : internal.interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = raycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster.filter) intersects = raycaster.filter(intersects, state);\n\n    for (var _iterator = _createForOfIteratorHelperLoose(intersects), _step; !(_step = _iterator()).done;) {\n      var _intersect = _step.value;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var _r3f;\n\n        var handlers = (_r3f = eventObject.__r3f) == null ? void 0 : _r3f.handlers;\n        if (handlers) intersections.push(_extends({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return intersections;\n  }\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n\n  function patchIntersects(intersections, event) {\n    var _store$getState3 = store.getState(),\n        internal = _store$getState3.internal; // If the interaction is captured, make all capturing targets  part of the\n    // intersect.\n\n\n    if ('pointerId' in event && internal.capturedMap.has(event.pointerId)) {\n      intersections.push.apply(intersections, internal.capturedMap.get(event.pointerId).values());\n    }\n\n    return intersections;\n  }\n  /**  Handles intersections by forwarding them to handlers */\n\n\n  function handleIntersects(intersections, event, callback) {\n    var _store$getState4 = store.getState(),\n        raycaster = _store$getState4.raycaster,\n        mouse = _store$getState4.mouse,\n        camera = _store$getState4.camera,\n        internal = _store$getState4.internal; // If anything has been found, forward it to the event listeners\n\n\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(camera);\n        var delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false\n        };\n\n        var _loop = function _loop() {\n          var hit = _step2.value;\n\n          var hasPointerCapture = function hasPointerCapture(id) {\n            var _internal$capturedMap, _internal$capturedMap2;\n\n            return (_internal$capturedMap = (_internal$capturedMap2 = internal.capturedMap.get(id)) == null ? void 0 : _internal$capturedMap2.has(hit.eventObject)) != null ? _internal$capturedMap : false;\n          };\n\n          var setPointerCapture = function setPointerCapture(id) {\n            if (internal.capturedMap.has(id)) {\n              // if the pointerId was previously captured, we add the hit to the\n              // event capturedMap.\n              internal.capturedMap.get(id).set(hit.eventObject, hit);\n            } else {\n              // if the pointerId was not previously captured, we create a map\n              // containing the hitObject, and the hit. hitObject is used for\n              // faster access.\n              internal.capturedMap.set(id, new Map([[hit.eventObject, hit]]));\n            } // Call the original event now\n            event.target.setPointerCapture(id);\n          }; // Add native event props\n\n\n          var extractEventProps = {};\n\n          for (var prop in Object.getPrototypeOf(event)) {\n            var property = event[prop]; // Only copy over atomics, leave functions alone as these should be\n            // called as event.nativeEvent.fn()\n\n            if (typeof property !== 'function') extractEventProps[prop] = property;\n          }\n\n          var raycastEvent = _extends({}, hit, extractEventProps, {\n            spaceX: mouse.x,\n            spaceY: mouse.y,\n            intersections: intersections,\n            stopped: localState.stopped,\n            delta: delta,\n            unprojectedPoint: unprojectedPoint,\n            ray: raycaster.ray,\n            camera: camera,\n            // Hijack stopPropagation, which just sets a flag\n            stopPropagation: function stopPropagation() {\n              // https://github.com/pmndrs/react-three-fiber/issues/596\n              // Events are not allowed to stop propagation if the pointer has been captured\n              var capturesForPointer = 'pointerId' in event && internal.capturedMap.get(event.pointerId); // We only authorize stopPropagation...\n\n              if ( // ...if this pointer hasn't been captured\n              !capturesForPointer || // ... or if the hit object is capturing the pointer\n              capturesForPointer.has(hit.eventObject)) {\n                raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n                // An event handler is only allowed to flush other handlers if it is hovered itself\n\n                if (internal.hovered.size && Array.from(internal.hovered.values()).find(function (i) {\n                  return i.eventObject === hit.eventObject;\n                })) {\n                  // Objects cannot flush out higher up objects that have already caught the event\n                  var higher = intersections.slice(0, intersections.indexOf(hit));\n                  cancelPointer([].concat(higher, [hit]));\n                }\n              }\n            },\n            // there should be a distinction between target and currentTarget\n            target: {\n              hasPointerCapture: hasPointerCapture,\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            },\n            currentTarget: {\n              hasPointerCapture: hasPointerCapture,\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            },\n            sourceEvent: event,\n            // deprecated\n            nativeEvent: event\n          }); // Call subscribers\n\n\n          callback(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n          if (localState.stopped === true) return \"break\";\n        };\n\n        for (var _iterator2 = _createForOfIteratorHelperLoose(intersections), _step2; !(_step2 = _iterator2()).done;) {\n          var _ret = _loop();\n\n          if (_ret === \"break\") break;\n        }\n      })();\n    }\n\n    return intersections;\n  }\n\n  function cancelPointer(hits) {\n    var _store$getState5 = store.getState(),\n        internal = _store$getState5.internal;\n\n    Array.from(internal.hovered.values()).forEach(function (hoveredObj) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (!hits.length || !hits.find(function (hit) {\n        return hit.object === hoveredObj.object && hit.index === hoveredObj.index;\n      })) {\n        var eventObject = hoveredObj.eventObject;\n        var handlers = eventObject.__r3f.handlers;\n        internal.hovered.delete(makeId(hoveredObj));\n\n        if (handlers) {\n          // Clear out intersects, they are outdated by now\n          var data = _extends({}, hoveredObj, {\n            intersections: hits || []\n          });\n\n          handlers.onPointerOut == null ? void 0 : handlers.onPointerOut(data);\n          handlers.onPointerLeave == null ? void 0 : handlers.onPointerLeave(data);\n        }\n      }\n    });\n  }\n\n  var handlePointer = function handlePointer(name) {\n    // Deal with cancelation\n    switch (name) {\n      case 'onPointerLeave':\n      case 'onPointerCancel':\n        return function () {\n          return cancelPointer([]);\n        };\n\n      case 'onLostPointerCapture':\n        return function (event) {\n          if ('pointerId' in event) {\n            // this will be a problem if one target releases the pointerId\n            // and another one is still keeping it, as the line below\n            // indifferently deletes all capturing references.\n            store.getState().internal.capturedMap.delete(event.pointerId);\n          }\n\n          cancelPointer([]);\n        };\n    } // Any other pointer goes here ...\n\n\n    return function (event) {\n      var _store$getState6 = store.getState(),\n          onPointerMissed = _store$getState6.onPointerMissed,\n          internal = _store$getState6.internal;\n\n      prepareRay(event); // Get fresh intersects\n\n      var isPointerMove = name === 'onPointerMove';\n      var filter = isPointerMove ? filterPointerEvents : undefined;\n      var hits = patchIntersects(intersect(filter), event); // Take care of unhover\n\n      if (isPointerMove) cancelPointer(hits);\n      handleIntersects(hits, event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__r3f.handlers; // Check presence of handlers\n\n        if (!handlers) return;\n\n        if (isPointerMove) {\n          // Move event ...\n          if (handlers.onPointerOver || handlers.onPointerEnter || handlers.onPointerOut || handlers.onPointerLeave) {\n            // When enter or out is present take care of hover-state\n            var id = makeId(data);\n            var hoveredItem = internal.hovered.get(id);\n\n            if (!hoveredItem) {\n              // If the object wasn't previously hovered, book it and call its handler\n              internal.hovered.set(id, data);\n              handlers.onPointerOver == null ? void 0 : handlers.onPointerOver(data);\n              handlers.onPointerEnter == null ? void 0 : handlers.onPointerEnter(data);\n            } else if (hoveredItem.stopped) {\n              // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n              data.stopPropagation();\n            }\n          } // Call mouse move\n\n\n          handlers.onPointerMove == null ? void 0 : handlers.onPointerMove(data);\n        } else {\n          // All other events ...\n          var handler = handlers == null ? void 0 : handlers[name];\n\n          if (handler) {\n            // Forward all events back to their respective handlers with the exception of click events,\n            // which must use the initial target\n            if (name !== 'onClick' && name !== 'onContextMenu' && name !== 'onDoubleClick' || internal.initialHits.includes(eventObject)) {\n              handler(data);\n              pointerMissed(event, internal.interaction.filter(function (object) {\n                return object !== eventObject;\n              }));\n            }\n          }\n        }\n      }); // Save initial coordinates on pointer-down\n\n      if (name === 'onPointerDown') {\n        internal.initialClick = [event.offsetX, event.offsetY];\n        internal.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      } // If a click yields no results, pass it back to the user as a miss\n\n\n      if ((name === 'onClick' || name === 'onContextMenu' || name === 'onDoubleClick') && !hits.length) {\n        if (calculateDistance(event) <= 2) {\n          pointerMissed(event, internal.interaction);\n          if (onPointerMissed) onPointerMissed(event);\n        }\n      }\n    };\n  };\n\n  function pointerMissed(event, objects) {\n    objects.forEach(function (object) {\n      var _r3f$handlers2;\n\n      return (_r3f$handlers2 = object.__r3f.handlers) == null ? void 0 : _r3f$handlers2.onPointerMissed == null ? void 0 : _r3f$handlers2.onPointerMissed(event);\n    });\n  }\n\n  return {\n    handlePointer: handlePointer\n  };\n}\n\nvar _excluded$3 = [\"args\"],\n    _excluded2 = [\"args\"],\n    _excluded3 = [\"args\"];\n\n// Type guard to tell a store from a portal\nvar isStore = function isStore(def) {\n  return def && !!def.getState;\n};\n\nvar getContainer = function getContainer(container, child) {\n  var _container$__r3f$root, _container$__r3f;\n\n  return {\n    // If the container is not a root-store then it must be a THREE.Object3D into which part of the\n    // scene is portalled into. Now there can be two variants of this, either that object is part of\n    // the regular jsx tree, in which case it already has __r3f with a valid root attached, or it lies\n    // outside react, in which case we must take the root of the child that is about to be attached to it.\n    root: isStore(container) ? container : (_container$__r3f$root = (_container$__r3f = container.__r3f) == null ? void 0 : _container$__r3f.root) != null ? _container$__r3f$root : child.__r3f.root,\n    // The container is the eventual target into which objects are mounted, it has to be a THREE.Object3D\n    container: isStore(container) ? container.getState().scene : container\n  };\n};\n\nvar DEFAULT = '__default';\nvar EMPTY = {};\nvar FILTER = ['children', 'key', 'ref'];\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, objects));\n}; // Each object in the scene carries a small LocalState descriptor\n\n\nfunction prepare(object, state) {\n  var instance = object;\n\n  if (state != null && state.instance || !instance.__r3f) {\n    instance.__r3f = _extends({\n      root: null,\n      memoizedProps: {},\n      objects: []\n    }, state);\n  }\n\n  return object;\n}\n\nfunction createRenderer(roots) {\n  function applyProps(instance, newProps, oldProps, accumulative) {\n    var _instance$__r3f, _root$getState, _instance$__r3f2;\n\n    if (oldProps === void 0) {\n      oldProps = {};\n    }\n\n    if (accumulative === void 0) {\n      accumulative = false;\n    }\n\n    // Filter equals, events and reserved props\n    var localState = (_instance$__r3f = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f : {};\n    var root = localState.root;\n    var rootState = (_root$getState = root == null ? void 0 : root.getState == null ? void 0 : root.getState()) != null ? _root$getState : {};\n    var sameProps = [];\n    var handlers = [];\n    var newMemoizedProps = {};\n    var i = 0;\n    Object.entries(newProps).forEach(function (_ref) {\n      var key = _ref[0],\n          entry = _ref[1];\n\n      // we don't want children, ref or key in the memoized props\n      if (FILTER.indexOf(key) === -1) {\n        newMemoizedProps[key] = entry;\n      }\n    });\n\n    if (localState.memoizedProps && localState.memoizedProps.args) {\n      newMemoizedProps.args = localState.memoizedProps.args;\n    }\n\n    if (localState.memoizedProps && localState.memoizedProps.attach) {\n      newMemoizedProps.attach = localState.memoizedProps.attach;\n    }\n\n    if (instance.__r3f) {\n      instance.__r3f.memoizedProps = newMemoizedProps;\n    }\n\n    var objectKeys = Object.keys(newProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (is.equ(newProps[objectKeys[i]], oldProps[objectKeys[i]])) {\n        sameProps.push(objectKeys[i]);\n      } // Event-handlers ...\n      //   are functions, that\n      //   start with \"on\", and\n      //   contain the name \"Pointer\", \"Click\", \"DoubleClick\", \"ContextMenu\", or \"Wheel\"\n\n\n      if (is.fun(newProps[objectKeys[i]]) && /^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(objectKeys[i])) {\n        handlers.push(objectKeys[i]);\n      }\n    } // Catch props that existed, but now exist no more ...\n\n\n    var leftOvers = [];\n\n    if (accumulative) {\n      objectKeys = Object.keys(oldProps);\n\n      for (i = 0; i < objectKeys.length; i++) {\n        if (!newProps.hasOwnProperty(objectKeys[i])) {\n          leftOvers.push(objectKeys[i]);\n        }\n      }\n    }\n\n    var toFilter = [].concat(sameProps, FILTER); // Instances use \"object\" as a reserved identifier\n\n    if ((_instance$__r3f2 = instance.__r3f) != null && _instance$__r3f2.instance) toFilter.push('object');\n\n    var filteredProps = _extends({}, newProps); // Removes sameProps and reserved props from newProps\n\n\n    objectKeys = Object.keys(filteredProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (toFilter.indexOf(objectKeys[i]) > -1) {\n        delete filteredProps[objectKeys[i]];\n      }\n    } // Collect all new props\n\n\n    var filteredPropsEntries = Object.entries(filteredProps); // Prepend left-overs so they can be reset or removed\n    // Left-overs must come first!\n\n    for (i = 0; i < leftOvers.length; i++) {\n      if (leftOvers[i] !== 'children') {\n        filteredPropsEntries.unshift([leftOvers[i], DEFAULT + 'remove']);\n      }\n    }\n\n    if (filteredPropsEntries.length > 0) {\n      filteredPropsEntries.forEach(function (_ref2) {\n        var key = _ref2[0],\n            value = _ref2[1];\n\n        if (!handlers.includes(key)) {\n          var currentInstance = instance;\n          var targetProp = currentInstance[key];\n\n          if (key.includes('-')) {\n            var entries = key.split('-');\n            targetProp = entries.reduce(function (acc, key) {\n              return acc[key];\n            }, instance); // If the target is atomic, it forces us to switch the root\n\n            if (!(targetProp && targetProp.set)) {\n              var _entries$reverse = entries.reverse(),\n                  _name = _entries$reverse[0],\n                  reverseEntries = _entries$reverse.slice(1);\n\n              currentInstance = reverseEntries.reverse().reduce(function (acc, key) {\n                return acc[key];\n              }, instance);\n              key = _name;\n            }\n          } // https://github.com/mrdoob/three.js/issues/21209\n          // HMR/fast-refresh relies on the ability to cancel out props, but threejs\n          // has no means to do this. Hence we curate a small collection of value-classes\n          // with their respective constructor/set arguments\n          // For removed props, try to set default values, if possible\n\n\n          if (value === DEFAULT + 'remove') {\n            if (targetProp && targetProp.constructor) {\n              // use the prop constructor to find the default it should be\n              value = new targetProp.constructor(newMemoizedProps.args);\n            } else if (currentInstance.constructor) {\n              // create a blank slate of the instance and copy the particular parameter.\n              // @ts-ignore\n              var defaultClassCall = new currentInstance.constructor(currentInstance.__r3f.memoizedProps.args);\n              value = defaultClassCall[targetProp]; // destory the instance\n\n              if (defaultClassCall.dispose) {\n                defaultClassCall.dispose();\n              }\n            } else {\n              // instance does not have constructor, just set it to 0\n              value = 0;\n            }\n          } // Special treatment for objects with support for set/copy, and layers\n\n\n          if (targetProp && targetProp.set && (targetProp.copy || targetProp instanceof THREE.Layers)) {\n            // If value is an array\n            if (Array.isArray(value)) {\n              if (targetProp.fromArray) {\n                targetProp.fromArray(value);\n              } else {\n                var _targetProp;\n\n                (_targetProp = targetProp).set.apply(_targetProp, value);\n              }\n            } // Test again target.copy(class) next ...\n            else if (targetProp.copy && value && value.constructor && targetProp.constructor.name === value.constructor.name) {\n                targetProp.copy(value);\n              } // If nothing else fits, just set the single value, ignore undefined\n              // https://github.com/react-spring/react-three-fiber/issues/274\n              else if (value !== undefined) {\n                  var isColor = targetProp instanceof THREE.Color; // Allow setting array scalars\n\n                  if (!isColor && targetProp.setScalar) targetProp.setScalar(value); // Layers have no copy function, we must therefore copy the mask property\n                  else if (targetProp instanceof THREE.Layers && value instanceof THREE.Layers) targetProp.mask = value.mask; // Otherwise just set ...\n                    else targetProp.set(value); // Auto-convert sRGB colors, for now ...\n                  // https://github.com/react-spring/react-three-fiber/issues/344\n\n                  if (!rootState.linear && isColor) targetProp.convertSRGBToLinear();\n                } // Else, just overwrite the value\n\n          } else {\n            currentInstance[key] = value; // Auto-convert sRGB textures, for now ...\n            // https://github.com/react-spring/react-three-fiber/issues/344\n\n            if (!rootState.linear && currentInstance[key] instanceof THREE.Texture) currentInstance[key].encoding = THREE.sRGBEncoding;\n          }\n\n          invalidateInstance(instance);\n        }\n      }); // Preemptively delete the instance from the containers interaction\n\n      if (accumulative && root && instance.raycast && localState.handlers) {\n        localState.handlers = undefined;\n        var index = rootState.internal.interaction.indexOf(instance);\n        if (index > -1) rootState.internal.interaction.splice(index, 1);\n      } // Prep interaction handlers\n\n\n      if (handlers.length) {\n        if (accumulative && root && instance.raycast) {\n          rootState.internal.interaction.push(instance);\n        } // Add handlers to the instances handler-map\n\n\n        localState.handlers = handlers.reduce(function (acc, key) {\n          var _extends2;\n\n          return _extends({}, acc, (_extends2 = {}, _extends2[key] = newProps[key], _extends2));\n        }, {});\n      } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n      if (instance.parent) updateInstance(instance);\n    }\n  }\n\n  function invalidateInstance(instance) {\n    var _instance$__r3f3, _instance$__r3f3$root;\n\n    var state = (_instance$__r3f3 = instance.__r3f) == null ? void 0 : (_instance$__r3f3$root = _instance$__r3f3.root) == null ? void 0 : _instance$__r3f3$root.getState == null ? void 0 : _instance$__r3f3$root.getState();\n    if (state && state.internal.frames === 0) state.invalidate();\n  }\n\n  function updateInstance(instance) {\n    instance.onUpdate == null ? void 0 : instance.onUpdate(instance);\n  }\n\n  function createInstance(type, _ref3, root, hostContext, internalInstanceHandle) {\n    var _ref3$args = _ref3.args,\n        args = _ref3$args === void 0 ? [] : _ref3$args,\n        props = _objectWithoutPropertiesLoose(_ref3, _excluded$3);\n\n    var name = \"\" + type[0].toUpperCase() + type.slice(1);\n    var instance; // https://github.com/facebook/react/issues/17147\n    // Portals do not give us a root, they are themselves treated as a root by the reconciler\n    // In order to figure out the actual root we have to climb through fiber internals :(\n\n    if (!isStore(root) && internalInstanceHandle) {\n      var fn = function fn(node) {\n        if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n      };\n\n      root = fn(internalInstanceHandle);\n    } // Assert that by now we have a valid root\n\n\n    if (!root || !isStore(root)) throw \"No valid root for \" + name + \"!\";\n\n    if (type === 'primitive') {\n      if (props.object === undefined) throw \"Primitives without 'object' are invalid!\";\n      var object = props.object;\n      instance = prepare(object, {\n        root: root,\n        instance: true\n      });\n    } else {\n      var target = catalogue[name] || THREE[name];\n      if (!target) throw name + \" is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively\";\n      var isArgsArr = is.arr(args); // Instanciate new object, link it to the root\n\n      instance = prepare(isArgsArr ? _construct(target, args) : new target(args), {\n        root: root,\n        // append memoized props with args so it's not forgotten\n        memoizedProps: {\n          args: isArgsArr && args.length === 0 ? null : args\n        }\n      });\n    } // Auto-attach geometries and materials\n\n\n    if (!('attachFns' in props)) {\n      if (name.endsWith('Geometry')) {\n        props = _extends({\n          attach: 'geometry'\n        }, props);\n      } else if (name.endsWith('Material')) {\n        props = _extends({\n          attach: 'material'\n        }, props);\n      }\n    } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n    // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n    // why it passes \"true\" here\n\n\n    applyProps(instance, props, {});\n    return instance;\n  }\n\n  function appendChild(parentInstance, child) {\n    var addedAsChild = false;\n\n    if (child) {\n      // The attach attribute implies that the object attaches itself on the parent\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = child;\n      } else if (is.arr(child.attachFns)) {\n        var _ref4 = child.attachFns,\n            attachFn = _ref4[0];\n\n        if (is.str(attachFn) && is.fun(parentInstance[attachFn])) {\n          parentInstance[attachFn](child);\n        } else if (is.fun(attachFn)) {\n          attachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D) {\n        // add in the usual parent-child way\n        parentInstance.add(child);\n        addedAsChild = true;\n      }\n\n      if (!addedAsChild) {\n        // This is for anything that used attach, and for non-Object3Ds that don't get attached to props;\n        // that is, anything that's a child in React but not a child in the scenegraph.\n        parentInstance.__r3f.objects.push(child);\n\n        child.parent = parentInstance;\n      }\n\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function insertBefore(parentInstance, child, beforeChild) {\n    var added = false;\n\n    if (child) {\n      if (child.attachArray) {\n        var array = parentInstance[child.attachArray];\n        if (!is.arr(array)) parentInstance[child.attachArray] = [];\n        array.splice(array.indexOf(beforeChild), 0, child);\n      } else if (child.attachObject || child.attach && !is.fun(child.attach)) {\n        // attach and attachObject don't have an order anyway, so just append\n        return appendChild(parentInstance, child);\n      } else if (child.isObject3D) {\n        child.parent = parentInstance;\n        child.dispatchEvent({\n          type: 'added'\n        });\n        var restSiblings = parentInstance.children.filter(function (sibling) {\n          return sibling !== child;\n        });\n        var index = restSiblings.indexOf(beforeChild);\n        parentInstance.children = [].concat(restSiblings.slice(0, index), [child], restSiblings.slice(index));\n        added = true;\n      }\n\n      if (!added) {\n        parentInstance.__r3f.objects.push(child);\n\n        child.parent = parentInstance;\n      }\n\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function removeRecursive(array, parent, dispose) {\n    if (dispose === void 0) {\n      dispose = false;\n    }\n\n    if (array) [].concat(array).forEach(function (child) {\n      return removeChild(parent, child, dispose);\n    });\n  }\n\n  function removeChild(parentInstance, child, dispose) {\n    if (child) {\n      var _child$__r3f2;\n\n      if (parentInstance.__r3f.objects) {\n        var oldLength = parentInstance.__r3f.objects.length;\n        parentInstance.__r3f.objects = parentInstance.__r3f.objects.filter(function (x) {\n          return x !== child;\n        });\n        var newLength = parentInstance.__r3f.objects.length; // was it in the list?\n\n        if (newLength < oldLength) {\n          // we had also set this, so we must clear it now\n          child.parent = null;\n        }\n      } // Remove attachment\n\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n          return x !== child;\n        });\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = null;\n      } else if (is.arr(child.attachFns)) {\n        var _ref5 = child.attachFns,\n            detachFn = _ref5[1];\n\n        if (is.str(detachFn) && is.fun(parentInstance[detachFn])) {\n          parentInstance[detachFn](child);\n        } else if (is.fun(detachFn)) {\n          detachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D) {\n        var _child$__r3f;\n\n        parentInstance.remove(child); // Remove interactivity\n\n        if ((_child$__r3f = child.__r3f) != null && _child$__r3f.root) {\n          removeInteractivity(child.__r3f.root, child);\n        }\n      } // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n      // Never dispose of primitives because their state may be kept outside of React!\n      // In order for an object to be able to dispose it has to have\n      //   - a dispose method,\n      //   - it cannot be an <instance object={...} />\n      //   - it cannot be a THREE.Scene, because three has broken it's own api\n      //\n      // Since disposal is recursive, we can check the optional dispose arg, which will be undefined\n      // when the reconciler calls it, but then carry our own check recursively\n\n\n      var isInstance = (_child$__r3f2 = child.__r3f) == null ? void 0 : _child$__r3f2.instance;\n      var shouldDispose = dispose === undefined ? child.dispose !== null && !isInstance : dispose; // Remove nested child objects. Primitives should not have objects and children that are\n      // attached to them declaratively ...\n\n      if (!isInstance) {\n        var _child$__r3f3;\n\n        removeRecursive((_child$__r3f3 = child.__r3f) == null ? void 0 : _child$__r3f3.objects, child, shouldDispose);\n        removeRecursive(child.children, child, shouldDispose);\n      } // Remove references\n\n\n      if (child.__r3f) {\n        delete child.__r3f.root;\n        delete child.__r3f.objects;\n        delete child.__r3f.handlers;\n        delete child.__r3f.memoizedProps;\n        if (!isInstance) delete child.__r3f;\n      } // Dispose item whenever the reconciler feels like it\n\n\n      if (shouldDispose && child.dispose && child.type !== 'Scene') {\n        unstable_runWithPriority(unstable_IdlePriority, function () {\n          return child.dispose();\n        });\n      }\n\n      invalidateInstance(parentInstance);\n    }\n  }\n\n  function switchInstance(instance, type, newProps, fiber) {\n    var parent = instance.parent;\n    if (!parent) return;\n    var newInstance = createInstance(type, newProps, instance.__r3f.root); // https://github.com/pmndrs/react-three-fiber/issues/1348\n    // When args change the instance has to be re-constructed, which then\n    // forces r3f to re-parent the children and non-scene objects\n\n    if (instance.children) {\n      instance.children.forEach(function (child) {\n        return appendChild(newInstance, child);\n      });\n      instance.children = [];\n    }\n\n    instance.__r3f.objects.forEach(function (child) {\n      return appendChild(newInstance, child);\n    });\n\n    instance.__r3f.objects = [];\n    removeChild(parent, instance);\n    appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n    // https://github.com/facebook/react/issues/14983\n    // https://github.com/facebook/react/pull/15021\n    ;\n    [fiber, fiber.alternate].forEach(function (fiber) {\n      if (fiber !== null) {\n        fiber.stateNode = newInstance;\n\n        if (fiber.ref) {\n          if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n        }\n      }\n    });\n  }\n\n  var reconciler = Reconciler({\n    now: unstable_now,\n    createInstance: createInstance,\n    removeChild: removeChild,\n    appendChild: appendChild,\n    appendInitialChild: appendChild,\n    insertBefore: insertBefore,\n    warnsIfNotActing: true,\n    supportsMutation: true,\n    isPrimaryRenderer: false,\n    // @ts-ignore\n    scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    // @ts-ignore\n    setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    noTimeout: -1,\n    appendChildToContainer: function appendChildToContainer(parentInstance, child) {\n      var _getContainer = getContainer(parentInstance, child),\n          container = _getContainer.container,\n          root = _getContainer.root; // Link current root to the default scene\n\n\n      container.__r3f.root = root;\n      appendChild(container, child);\n    },\n    removeChildFromContainer: function removeChildFromContainer(parentInstance, child) {\n      var _getContainer2 = getContainer(parentInstance, child),\n          container = _getContainer2.container;\n\n      removeChild(container, child);\n    },\n    insertInContainerBefore: function insertInContainerBefore(parentInstance, child, beforeChild) {\n      var _getContainer3 = getContainer(parentInstance, child),\n          container = _getContainer3.container;\n\n      insertBefore(container, child, beforeChild);\n    },\n    commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n      if (instance.__r3f.instance && newProps.object && newProps.object !== instance) {\n        // <instance object={...} /> where the object reference has changed\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // This is a data object, let's extract critical information about it\n        var _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutPropertiesLoose(newProps, _excluded2);\n\n        var _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutPropertiesLoose(oldProps, _excluded3); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n        var hasNewArgs = argsNew.some(function (value, index) {\n          return is.obj(value) ? Object.entries(value).some(function (_ref6) {\n            var key = _ref6[0],\n                val = _ref6[1];\n            return val !== argsOld[index][key];\n          }) : value !== argsOld[index];\n        });\n\n        if (hasNewArgs) {\n          // Next we create a new instance and append it again\n          switchInstance(instance, type, newProps, fiber);\n        } else {\n          // Otherwise just overwrite props\n          applyProps(instance, restNew, restOld, true);\n        }\n      }\n    },\n    hideInstance: function hideInstance(instance) {\n      if (instance.isObject3D) {\n        instance.visible = false;\n        invalidateInstance(instance);\n      }\n    },\n    unhideInstance: function unhideInstance(instance, props) {\n      if (instance.isObject3D && props.visible == null || props.visible) {\n        instance.visible = true;\n        invalidateInstance(instance);\n      }\n    },\n    hideTextInstance: function hideTextInstance() {\n      throw new Error('Text is not allowed in the R3F tree.');\n    },\n    getPublicInstance: function getPublicInstance(instance) {\n      // TODO: might fix switchInstance (?)\n      return instance;\n    },\n    getRootHostContext: function getRootHostContext(rootContainer) {\n      return EMPTY;\n    },\n    getChildHostContext: function getChildHostContext(parentHostContext) {\n      return EMPTY;\n    },\n    createTextInstance: function createTextInstance() {},\n    finalizeInitialChildren: function finalizeInitialChildren(instance) {\n      // https://github.com/facebook/react/issues/20271\n      // Returning true will trigger commitMount\n      return !!instance.__r3f.handlers;\n    },\n    commitMount: function commitMount(instance)\n    /*, type, props*/\n    {\n      // https://github.com/facebook/react/issues/20271\n      // This will make sure events are only added once to the central container\n      if (instance.raycast && instance.__r3f.handlers) instance.__r3f.root.getState().internal.interaction.push(instance);\n    },\n    prepareUpdate: function prepareUpdate() {\n      return EMPTY;\n    },\n    shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n      return false;\n    },\n    prepareForCommit: function prepareForCommit() {\n      return null;\n    },\n    preparePortalMount: function preparePortalMount() {// noop\n    },\n    resetAfterCommit: function resetAfterCommit() {// noop\n    },\n    shouldSetTextContent: function shouldSetTextContent() {\n      return false;\n    },\n    clearContainer: function clearContainer() {\n      return false;\n    }\n  });\n  return {\n    reconciler: reconciler,\n    applyProps: applyProps\n  };\n}\n\nvar _excluded$2 = [\"params\"];\nvar isRenderer = function isRenderer(def) {\n  return def && !!def.render;\n};\nvar isOrthographicCamera = function isOrthographicCamera(def) {\n  return def && def.isOrthographicCamera;\n};\nvar context = /*#__PURE__*/React.createContext(null);\n\nvar createStore = function createStore(applyProps, _invalidate, _advance, props) {\n  var gl = props.gl,\n      size = props.size,\n      _props$shadows = props.shadows,\n      shadows = _props$shadows === void 0 ? false : _props$shadows,\n      _props$linear = props.linear,\n      linear = _props$linear === void 0 ? false : _props$linear,\n      _props$flat = props.flat,\n      flat = _props$flat === void 0 ? false : _props$flat,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$orthographic = props.orthographic,\n      orthographic = _props$orthographic === void 0 ? false : _props$orthographic,\n      _props$frameloop = props.frameloop,\n      frameloop = _props$frameloop === void 0 ? 'always' : _props$frameloop,\n      _props$dpr = props.dpr,\n      dpr = _props$dpr === void 0 ? 1 : _props$dpr,\n      performance = props.performance,\n      _props$clock = props.clock,\n      clock = _props$clock === void 0 ? new THREE.Clock() : _props$clock,\n      raycastOptions = props.raycaster,\n      cameraOptions = props.camera,\n      onPointerMissed = props.onPointerMissed; // Set shadowmap\n\n  if (shadows) {\n    gl.shadowMap.enabled = true;\n    if (typeof shadows === 'object') Object.assign(gl.shadowMap, shadows);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n  } // Set color management\n\n\n  if (!linear) {\n    if (!flat) gl.toneMapping = THREE.ACESFilmicToneMapping;\n    gl.outputEncoding = THREE.sRGBEncoding;\n  } // clock.elapsedTime is updated using advance(timestamp)\n\n\n  if (frameloop === 'never') {\n    clock.stop();\n    clock.elapsedTime = 0;\n  }\n\n  var rootState = create(function (set, get) {\n    // Create custom raycaster\n    var raycaster = new THREE.Raycaster();\n\n    var _ref = raycastOptions || {},\n        params = _ref.params,\n        options = _objectWithoutPropertiesLoose(_ref, _excluded$2);\n\n    applyProps(raycaster, _extends({\n      enabled: true\n    }, options, {\n      params: _extends({}, raycaster.params, params)\n    }), {}); // Create default camera\n\n    var isCamera = cameraOptions instanceof THREE.Camera;\n    var camera = isCamera ? cameraOptions : orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n\n    if (!isCamera) {\n      camera.position.z = 5;\n      if (cameraOptions) applyProps(camera, cameraOptions, {}); // Always look at center by default\n\n      camera.lookAt(0, 0, 0);\n    }\n\n    function _setDpr(dpr) {\n      return Array.isArray(dpr) ? Math.min(Math.max(dpr[0], window.devicePixelRatio), dpr[1]) : dpr;\n    }\n\n    var initialDpr = _setDpr(dpr);\n\n    var position = new THREE.Vector3();\n    var defaultTarget = new THREE.Vector3();\n\n    function getCurrentViewport(camera, target, size) {\n      if (camera === void 0) {\n        camera = get().camera;\n      }\n\n      if (target === void 0) {\n        target = defaultTarget;\n      }\n\n      if (size === void 0) {\n        size = get().size;\n      }\n\n      var _size = size,\n          width = _size.width,\n          height = _size.height;\n      var aspect = width / height;\n      var distance = camera.getWorldPosition(position).distanceTo(target);\n\n      if (isOrthographicCamera(camera)) {\n        return {\n          width: width / camera.zoom,\n          height: height / camera.zoom,\n          factor: 1,\n          distance: distance,\n          aspect: aspect\n        };\n      } else {\n        var fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n        var h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n        var w = h * (width / height);\n        return {\n          width: w,\n          height: h,\n          factor: width / w,\n          distance: distance,\n          aspect: aspect\n        };\n      }\n    }\n\n    var performanceTimeout = undefined;\n\n    var setPerformanceCurrent = function setPerformanceCurrent(current) {\n      return set(function (state) {\n        return {\n          performance: _extends({}, state.performance, {\n            current: current\n          })\n        };\n      });\n    };\n\n    return {\n      gl: gl,\n      set: set,\n      get: get,\n      invalidate: function invalidate() {\n        return _invalidate(get());\n      },\n      advance: function advance(timestamp, runGlobalEffects) {\n        return _advance(timestamp, runGlobalEffects, get());\n      },\n      linear: linear,\n      flat: flat,\n      scene: prepare(new THREE.Scene()),\n      camera: camera,\n      controls: null,\n      raycaster: raycaster,\n      clock: clock,\n      mouse: new THREE.Vector2(),\n      vr: vr,\n      frameloop: frameloop,\n      onPointerMissed: onPointerMissed,\n      performance: _extends({\n        current: 1,\n        min: 0.5,\n        max: 1,\n        debounce: 200\n      }, performance, {\n        regress: function regress() {\n          var state = get(); // Clear timeout\n\n          if (performanceTimeout) clearTimeout(performanceTimeout); // Set lower bound performance\n\n          if (state.performance.current !== state.performance.min) setPerformanceCurrent(state.performance.min); // Go back to upper bound performance after a while unless something regresses meanwhile\n\n          performanceTimeout = setTimeout(function () {\n            return setPerformanceCurrent(get().performance.max);\n          }, state.performance.debounce);\n        }\n      }),\n      size: {\n        width: 0,\n        height: 0\n      },\n      viewport: {\n        initialDpr: initialDpr,\n        dpr: initialDpr,\n        width: 0,\n        height: 0,\n        aspect: 0,\n        distance: 0,\n        factor: 0,\n        getCurrentViewport: getCurrentViewport\n      },\n      setSize: function setSize(width, height) {\n        var size = {\n          width: width,\n          height: height\n        };\n        set(function (state) {\n          return {\n            size: size,\n            viewport: _extends({}, state.viewport, getCurrentViewport(camera, defaultTarget, size))\n          };\n        });\n      },\n      setDpr: function setDpr(dpr) {\n        return set(function (state) {\n          return {\n            viewport: _extends({}, state.viewport, {\n              dpr: _setDpr(dpr)\n            })\n          };\n        });\n      },\n      events: {\n        connected: false\n      },\n      internal: {\n        active: false,\n        priority: 0,\n        frames: 0,\n        lastProps: props,\n        interaction: [],\n        hovered: new Map(),\n        subscribers: [],\n        initialClick: [0, 0],\n        initialHits: [],\n        capturedMap: new Map(),\n        subscribe: function subscribe(ref, priority) {\n          if (priority === void 0) {\n            priority = 0;\n          }\n\n          set(function (_ref2) {\n            var internal = _ref2.internal;\n            return {\n              internal: _extends({}, internal, {\n                // If this subscription was given a priority, it takes rendering into its own hands\n                // For that reason we switch off automatic rendering and increase the manual flag\n                // As long as this flag is positive (there could be multiple render subscription)\n                // ..there can be no internal rendering at all\n                priority: internal.priority + (priority > 0 ? 1 : 0),\n                // Register subscriber and sort layers from lowest to highest, meaning,\n                // highest priority renders last (on top of the other frames)\n                subscribers: [].concat(internal.subscribers, [{\n                  ref: ref,\n                  priority: priority\n                }]).sort(function (a, b) {\n                  return a.priority - b.priority;\n                })\n              })\n            };\n          });\n          return function () {\n            set(function (_ref3) {\n              var internal = _ref3.internal;\n              return {\n                internal: _extends({}, internal, {\n                  // Decrease manual flag if this subscription had a priority\n                  priority: internal.priority - (priority > 0 ? 1 : 0),\n                  // Remove subscriber from list\n                  subscribers: internal.subscribers.filter(function (s) {\n                    return s.ref !== ref;\n                  })\n                })\n              };\n            });\n          };\n        }\n      }\n    };\n  }); // Resize camera and renderer on changes to size and pixelratio\n\n  rootState.subscribe(function () {\n    var _rootState$getState = rootState.getState(),\n        camera = _rootState$getState.camera,\n        size = _rootState$getState.size,\n        viewport = _rootState$getState.viewport,\n        internal = _rootState$getState.internal; // https://github.com/pmndrs/react-three-fiber/issues/92\n    // Do not mess with the camera if it belongs to the user\n\n\n    if (!(internal.lastProps.camera instanceof THREE.Camera)) {\n      if (isOrthographicCamera(camera)) {\n        camera.left = size.width / -2;\n        camera.right = size.width / 2;\n        camera.top = size.height / 2;\n        camera.bottom = size.height / -2;\n      } else {\n        camera.aspect = size.width / size.height;\n      }\n\n      camera.updateProjectionMatrix(); // https://github.com/pmndrs/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      camera.updateMatrixWorld();\n    } // Update renderer\n\n\n    gl.setPixelRatio(viewport.dpr);\n    gl.setSize(size.width, size.height);\n  }, function (state) {\n    return [state.viewport.dpr, state.size];\n  }, shallow);\n  var state = rootState.getState(); // Update size\n\n  if (size) state.setSize(size.width, size.height); // Invalidate on any change\n\n  rootState.subscribe(function (state) {\n    return _invalidate(state);\n  }); // Return root state\n\n  return rootState;\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar i;\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\n\nfunction run(effects, timestamp) {\n  for (i = 0; i < effects.length; i++) {\n    effects[i](timestamp);\n  }\n}\n\nfunction render$1(timestamp, state) {\n  // Run local effects\n  var delta = state.clock.getDelta(); // In frameloop='never' mode, clock times are updated using the provided timestamp\n\n  if (state.frameloop === 'never' && typeof timestamp === 'number') {\n    delta = timestamp - state.clock.elapsedTime;\n    state.clock.oldTime = state.clock.elapsedTime;\n    state.clock.elapsedTime = timestamp;\n  } // Call subscribers (useFrame)\n\n\n  for (i = 0; i < state.internal.subscribers.length; i++) {\n    state.internal.subscribers[i].ref.current(state, delta);\n  } // Render content\n\n\n  if (!state.internal.priority && state.gl.render) state.gl.render(state.scene, state.camera); // Decrease frame count\n\n  state.internal.frames = Math.max(0, state.internal.frames - 1);\n  return state.frameloop === 'always' ? 1 : state.internal.frames;\n}\n\nfunction createLoop(roots) {\n  var running = false;\n  var repeat;\n\n  function loop(timestamp) {\n    running = true;\n    repeat = 0; // Run effects\n\n    run(globalEffects, timestamp); // Render all roots\n\n    roots.forEach(function (root) {\n      var state = root.store.getState(); // If the frameloop is invalidated, do not run another frame\n\n      if (state.internal.active && (state.frameloop === 'always' || state.internal.frames > 0)) repeat += render$1(timestamp, state);\n    }); // Run after-effects\n\n    run(globalAfterEffects, timestamp); // Keep on looping if anything invalidates the frameloop\n\n    if (repeat > 0) return requestAnimationFrame(loop); // Tail call effects, they are called when rendering stops\n    else run(globalTailEffects, timestamp); // Flag end of operation\n\n    running = false;\n  }\n\n  function invalidate(state) {\n    if (!state) return roots.forEach(function (root) {\n      return invalidate(root.store.getState());\n    });\n    if (state.vr || !state.internal.active || state.frameloop === 'never') return; // Increase frames, do not go higher than 60\n\n    state.internal.frames = Math.min(60, state.internal.frames + 1); // If the render-loop isn't active, start it\n\n    if (!running) {\n      running = true;\n      requestAnimationFrame(loop);\n    }\n  }\n\n  function advance(timestamp, runGlobalEffects, state) {\n    if (runGlobalEffects === void 0) {\n      runGlobalEffects = true;\n    }\n\n    if (runGlobalEffects) run(globalEffects, timestamp);\n    if (!state) roots.forEach(function (root) {\n      return render$1(timestamp, root.store.getState());\n    });else render$1(timestamp, state);\n    if (runGlobalEffects) run(globalAfterEffects, timestamp);\n  }\n\n  return {\n    loop: loop,\n    invalidate: invalidate,\n    advance: advance\n  };\n}\n\nfunction createPointerEvents(store) {\n  var _createEvents = createEvents(store),\n      handlePointer = _createEvents.handlePointer;\n\n  var names = {\n    onClick: ['click', false],\n    onContextMenu: ['contextmenu', false],\n    onDoubleClick: ['dblclick', false],\n    onWheel: ['wheel', true],\n    onPointerDown: ['pointerdown', true],\n    onPointerUp: ['pointerup', true],\n    onPointerLeave: ['pointerleave', true],\n    onPointerMove: ['pointermove', true],\n    onPointerCancel: ['pointercancel', true],\n    onLostPointerCapture: ['lostpointercapture', true]\n  };\n  return {\n    connected: false,\n    handlers: Object.keys(names).reduce(function (acc, key) {\n      var _extends2;\n\n      return _extends({}, acc, (_extends2 = {}, _extends2[key] = handlePointer(key), _extends2));\n    }, {}),\n    connect: function connect(target) {\n      var _events$handlers;\n\n      var _store$getState = store.getState(),\n          set = _store$getState.set,\n          events = _store$getState.events;\n\n      events.disconnect == null ? void 0 : events.disconnect();\n      set(function (state) {\n        return {\n          events: _extends({}, state.events, {\n            connected: target\n          })\n        };\n      });\n      Object.entries((_events$handlers = events == null ? void 0 : events.handlers) != null ? _events$handlers : []).forEach(function (_ref) {\n        var name = _ref[0],\n            event = _ref[1];\n        var _names = names[name],\n            eventName = _names[0],\n            passive = _names[1];\n        target.addEventListener(eventName, event, {\n          passive: passive\n        });\n      });\n    },\n    disconnect: function disconnect() {\n      var _store$getState2 = store.getState(),\n          set = _store$getState2.set,\n          events = _store$getState2.events;\n\n      if (events.connected) {\n        var _events$handlers2;\n\n        Object.entries((_events$handlers2 = events.handlers) != null ? _events$handlers2 : []).forEach(function (_ref2) {\n          var name = _ref2[0],\n              event = _ref2[1];\n\n          if (events && events.connected instanceof HTMLElement) {\n            var _names2 = names[name],\n                eventName = _names2[0];\n            events.connected.removeEventListener(eventName, event);\n          }\n        });\n        set(function (state) {\n          return {\n            events: _extends({}, state.events, {\n              connected: false\n            })\n          };\n        });\n      }\n    }\n  };\n}\n\nvar _excluded$1 = [\"children\", \"fallback\", \"tabIndex\", \"resize\", \"id\", \"style\", \"className\", \"events\"];\n// React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser.\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\n\nfunction Block(_ref) {\n  var set = _ref.set;\n  useIsomorphicLayoutEffect(function () {\n    set(new Promise(function () {\n      return null;\n    }));\n    return function () {\n      return set(false);\n    };\n  }, []);\n  return null;\n}\n\nvar ErrorBoundary = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(ErrorBoundary, _React$Component);\n\n  function ErrorBoundary() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;\n    _this.state = {\n      error: false\n    };\n    return _this;\n  }\n\n  var _proto = ErrorBoundary.prototype;\n\n  _proto.componentDidCatch = function componentDidCatch(error) {\n    this.props.set(error);\n  };\n\n  _proto.render = function render() {\n    return this.state.error ? null : this.props.children;\n  };\n\n  return ErrorBoundary;\n}(React.Component);\n\nErrorBoundary.getDerivedStateFromError = function () {\n  return {\n    error: true\n  };\n};\n\nvar Canvas = /*#__PURE__*/React.forwardRef(function Canvas(_ref2, forwardedRef) {\n  var children = _ref2.children,\n      fallback = _ref2.fallback,\n      tabIndex = _ref2.tabIndex,\n      resize = _ref2.resize,\n      id = _ref2.id,\n      style = _ref2.style,\n      className = _ref2.className,\n      events = _ref2.events,\n      props = _objectWithoutPropertiesLoose(_ref2, _excluded$1);\n\n  var _useMeasure = useMeasure(_extends({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    }\n  }, resize)),\n      containerRef = _useMeasure[0],\n      size = _useMeasure[1];\n\n  var canvasRef = React.useRef(null);\n\n  var _React$useState = React.useState(false),\n      block = _React$useState[0],\n      setBlock = _React$useState[1];\n\n  var _React$useState2 = React.useState(false),\n      error = _React$useState2[0],\n      setError = _React$useState2[1]; // Suspend this component if block is a promise (2nd run)\n\n\n  if (block) throw block; // Throw exception outwards if anything within canvas throws\n\n  if (error) throw error; // Execute JSX in the reconciler as a layout-effect\n\n  useIsomorphicLayoutEffect(function () {\n    if (size.width > 0 && size.height > 0) {\n      render( /*#__PURE__*/React.createElement(ErrorBoundary, {\n        set: setError\n      }, /*#__PURE__*/React.createElement(React.Suspense, {\n        fallback: /*#__PURE__*/React.createElement(Block, {\n          set: setBlock\n        })\n      }, children)), canvasRef.current, _extends({}, props, {\n        size: size,\n        events: events || createPointerEvents\n      }));\n    }\n  }, [size, children]);\n  useIsomorphicLayoutEffect(function () {\n    var container = canvasRef.current;\n    return function () {\n      return unmountComponentAtNode(container);\n    };\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: containerRef,\n    id: id,\n    className: className,\n    tabIndex: tabIndex,\n    style: _extends({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }, /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: mergeRefs([canvasRef, forwardedRef]),\n    style: {\n      display: 'block'\n    }\n  }, fallback));\n});\n\nfunction useThree(selector, equalityFn) {\n  if (selector === void 0) {\n    selector = function selector(state) {\n      return state;\n    };\n  }\n\n  var useStore = React.useContext(context);\n  if (!useStore) throw \"R3F hooks can only be used within the Canvas component!\";\n  return useStore(selector, equalityFn);\n}\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var subscribe = React.useContext(context).getState().internal.subscribe; // Update ref\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useLayoutEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction buildGraph(object) {\n  var data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(function (obj) {\n      if (obj.name) {\n        data.nodes[obj.name] = obj;\n      }\n\n      if (obj.material && !data.materials[obj.material.name]) {\n        data.materials[obj.material.name] = obj.material;\n      }\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(function () {\n    return buildGraph(object);\n  }, [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto) {\n    // Construct new loader and run extensions\n    var loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    for (var _len = arguments.length, input = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      input[_key - 1] = arguments[_key];\n    }\n\n    return Promise.all(input.map(function (input) {\n      return new Promise(function (res, reject) {\n        return loader.load(input, function (data) {\n          if (data.scene) Object.assign(data, buildGraph(data.scene));\n          res(data);\n        }, onProgress, function (error) {\n          return reject(\"Could not load \" + input + \": \" + error.message);\n        });\n      });\n    }));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  var keys = Array.isArray(input) ? input : [input];\n  var results = useAsset.apply(void 0, [loadingFn(extensions, onProgress), Proto].concat(keys)); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  var keys = Array.isArray(input) ? input : [input];\n  return useAsset.preload.apply(useAsset, [loadingFn(extensions), Proto].concat(keys));\n};\n\nvar _excluded = [\"gl\", \"size\", \"mode\", \"events\", \"onCreated\"];\nvar roots = new Map();\nvar modes = ['legacy', 'blocking', 'concurrent'];\n\nvar _createLoop = createLoop(roots),\n    invalidate = _createLoop.invalidate,\n    advance = _createLoop.advance;\n\nvar _createRenderer = createRenderer(),\n    reconciler = _createRenderer.reconciler,\n    applyProps = _createRenderer.applyProps;\n\nvar createRendererInstance = function createRendererInstance(gl, canvas) {\n  return isRenderer(gl) ? gl : new THREE.WebGLRenderer(_extends({\n    powerPreference: 'high-performance',\n    canvas: canvas,\n    antialias: true,\n    alpha: true\n  }, gl));\n};\n\nfunction render(element, canvas, _temp) {\n  var _store;\n\n  var _ref = _temp === void 0 ? {} : _temp,\n      gl = _ref.gl,\n      size = _ref.size,\n      _ref$mode = _ref.mode,\n      mode = _ref$mode === void 0 ? modes[1] : _ref$mode,\n      events = _ref.events,\n      onCreated = _ref.onCreated,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  // Allow size to take on container bounds initially\n  if (!size) {\n    var _canvas$parentElement, _canvas$parentElement2, _canvas$parentElement3, _canvas$parentElement4;\n\n    size = {\n      width: (_canvas$parentElement = (_canvas$parentElement2 = canvas.parentElement) == null ? void 0 : _canvas$parentElement2.clientWidth) != null ? _canvas$parentElement : 0,\n      height: (_canvas$parentElement3 = (_canvas$parentElement4 = canvas.parentElement) == null ? void 0 : _canvas$parentElement4.clientHeight) != null ? _canvas$parentElement3 : 0\n    };\n  }\n\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n  var store = root == null ? void 0 : root.store;\n  var state = (_store = store) == null ? void 0 : _store.getState();\n\n  if (fiber && state) {\n    var lastProps = state.internal.lastProps; // When a root was found, see if any fundamental props must be changed or exchanged\n    // Check pixelratio\n\n    if (props.dpr !== undefined && !is.equ(lastProps.dpr, props.dpr)) state.setDpr(props.dpr); // Check size\n\n    if (!is.equ(lastProps.size, size)) state.setSize(size.width, size.height); // For some props we want to reset the entire root\n    // Changes to the color-space\n\n    var linearChanged = props.linear !== lastProps.linear;\n\n    if (linearChanged) {\n      unmountComponentAtNode(canvas);\n      fiber = undefined;\n    }\n  }\n\n  if (!fiber) {\n    // If no root has been found, make one\n    // Create gl\n    var glRenderer = createRendererInstance(gl, canvas); // Enable VR if requested\n\n    if (props.vr) {\n      glRenderer.xr.enabled = true;\n      glRenderer.setAnimationLoop(function (timestamp) {\n        return advance(timestamp, true);\n      });\n    } // Create store\n\n\n    store = createStore(applyProps, invalidate, advance, _extends({\n      gl: glRenderer,\n      size: size\n    }, props));\n\n    var _state = store.getState(); // Create renderer\n\n\n    fiber = reconciler.createContainer(store, modes.indexOf(mode), false, null); // Map it\n\n    roots.set(canvas, {\n      fiber: fiber,\n      store: store\n    }); // Store events internally\n\n    if (events) _state.set({\n      events: events(store)\n    });\n  }\n\n  if (store && fiber) {\n    reconciler.updateContainer( /*#__PURE__*/React.createElement(Provider, {\n      store: store,\n      element: element,\n      onCreated: onCreated,\n      target: canvas\n    }), fiber, null, function () {\n      return undefined;\n    });\n    return store;\n  } else {\n    throw 'Error creating root!';\n  }\n}\n\nfunction Provider(_ref2) {\n  var store = _ref2.store,\n      element = _ref2.element,\n      onCreated = _ref2.onCreated,\n      target = _ref2.target;\n  React.useEffect(function () {\n    var state = store.getState(); // Flag the canvas active, rendering will now begin\n\n    state.set(function (state) {\n      return {\n        internal: _extends({}, state.internal, {\n          active: true\n        })\n      };\n    }); // Connect events\n\n    state.events.connect == null ? void 0 : state.events.connect(target); // Notifiy that init is completed, the scene graph exists, but nothing has yet rendered\n\n    if (onCreated) onCreated(state);\n  }, []);\n  return /*#__PURE__*/React.createElement(context.Provider, {\n    value: store\n  }, element);\n}\n\nfunction unmountComponentAtNode(canvas, callback) {\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n\n  if (fiber) {\n    var _state2 = root == null ? void 0 : root.store.getState();\n\n    if (_state2) _state2.internal.active = false;\n    reconciler.updateContainer(null, fiber, null, function () {\n      if (_state2) {\n        setTimeout(function () {\n          var _state2$gl, _state2$gl$renderList, _state2$gl2;\n\n          _state2.events.disconnect == null ? void 0 : _state2.events.disconnect();\n          (_state2$gl = _state2.gl) == null ? void 0 : (_state2$gl$renderList = _state2$gl.renderLists) == null ? void 0 : _state2$gl$renderList.dispose == null ? void 0 : _state2$gl$renderList.dispose();\n          (_state2$gl2 = _state2.gl) == null ? void 0 : _state2$gl2.forceContextLoss == null ? void 0 : _state2$gl2.forceContextLoss();\n          dispose(_state2);\n          roots.delete(canvas);\n          if (callback) callback(canvas);\n        }, 500);\n      }\n    });\n  }\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (var p in obj) {\n    var _dispose, _ref3;\n    (_dispose = (_ref3 = p).dispose) == null ? void 0 : _dispose.call(_ref3);\n    delete obj[p];\n  }\n}\n\nvar act = reconciler.act;\nvar hasSymbol = is.fun(Symbol) && Symbol.for;\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction createPortal(children, container, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: prepare(container),\n    implementation: implementation\n  };\n}\n\nreconciler.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  rendererPackageName: '@react-three/fiber',\n  version: '17.0.2'\n});\n\nexport { Canvas, threeTypes as ReactThreeFiber, roots as _roots, act, addAfterEffect, addEffect, addTail, advance, applyProps, context, createPortal, dispose, createPointerEvents as events, extend, invalidate, reconciler, render, unmountComponentAtNode, useFrame, useGraph, useLoader, useThree };\n"]},"metadata":{},"sourceType":"module"}